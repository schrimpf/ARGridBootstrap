<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.553">

  <meta name="author" content="Paul Schrimpf">
  <meta name="dcterms.date" content="2024-04-30">
  <title>ARGridBootstrap - Julia at Full Tilt: Profiling and Optimizations</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="styles.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Julia at Full Tilt: Profiling and Optimizations</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Paul Schrimpf 
</div>
</div>
</div>

  <p class="date">2024-04-30</p>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="about-me" class="slide level2">
<h2>About Me</h2>
<ul>
<li><a href="economics.ubc.ca">UBC Economics</a>, research in econometrics, industrial organization</li>
<li><a href="http://faculty.arts.ubc.ca/pschrimpf/">My Website</a></li>
<li><a href="https://github.com/schrimpf">my github</a></li>
<li>Teach courses using Julia
<ul>
<li><a href="Computational Economics with Data Science Applications">ECON 622: Computational Economics with Data Science Applications</a></li>
<li><a href="http://faculty.arts.ubc.ca/pschrimpf/567/index.html">ECON 567 (empirical industrial organization)</a></li>
</ul></li>
</ul>
</section>
<section id="useful-resources" class="slide level2">
<h2>Useful Resources</h2>
<ul>
<li><p><a href="https://docs.julialang.org/en/v1/manual/performance-tips/">Performance Tips in Julia Manual</a></p></li>
<li><p><a href="https://viralinstruction.com/posts/optimise/">How to optimise Julia code: A practical guide</a> <span class="citation" data-cites="nissen2022">Nissen (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span></p></li>
<li><p><a href="https://book.sciml.ai/notes/02-Optimizing_Serial_Code/">Optimizing Serial Code</a> <span class="citation" data-cites="rackauckas2019a">Rackauckas (<a href="#/references" role="doc-biblioref" onclick="">2019</a>)</span></p></li>
<li><p><a href="https://schrimpf.github.io/ARGridBootstrap.jl/argridboot.html">Coding for performance</a> (basis for this talk) <span class="citation" data-cites="schrimpfARGridBootstrap">Schrimpf (<a href="#/references" role="doc-biblioref" onclick="">2019 (revised 2024)</a>)</span></p></li>
</ul>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<p><img data-src="westdri_talk_files/figure-revealjs/mermaid-figure-1.png" style="width:15.91in;height:6.05in"></p>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section></section>
<section>
<section id="basics" class="title-slide slide level1 center">
<h1>Basics</h1>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<p><img data-src="westdri_talk_files/figure-revealjs/mermaid-figure-3.png" style="width:15.91in;height:6.05in"></p>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="avoid-premature-optimization" class="slide level2">
<h2>Avoid Premature Optimization</h2>
<div>
<ul>
<li class="fragment">Complete, correct <span class="math inline">\(&gt;&gt;\)</span> fast, incorrect, unfinished</li>
<li class="fragment">Clear, maintainable <span class="math inline">\(&gt;\)</span> fast, incomprensible (almost always)</li>
<li class="fragment">But some practices can both make code faster and clearer</li>
</ul>
</div>
</section>
<section id="functions" class="slide level2">
<h2>Functions</h2>
<ul>
<li>Julia functions are JIT compiled, global scripts are not</li>
<li>Code needs to be in a function for full performance</li>
<li>Organizing code into functions is also better for readability and maintenance</li>
</ul>
</section>
<section id="type-stability" class="slide level2">
<h2>Type Stability</h2>
<ul>
<li>To generate efficient code, the Julia compiler needs to know the types of all variables</li>
<li>Given the types of the inputs of a function, the types of its intermediate variables and output should be deterministic</li>
</ul>
</section>
<section id="type-stable-example" class="slide level2">
<h2>Type Stable: Example</h2>
<div id="08ad4e99" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb1-2"><a></a><span class="kw">function</span> <span class="fu">unstabletrick</span>(x, t)</span>
<span id="cb1-3"><a></a>  <span class="fu">sum</span>(xi <span class="op">&lt;</span> t ? xi <span class="op">:</span> t <span class="cf">for</span> xi <span class="kw">in</span> x)</span>
<span id="cb1-4"><a></a><span class="cf">end</span></span>
<span id="cb1-5"><a></a></span>
<span id="cb1-6"><a></a>t <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb1-7"><a></a>n <span class="op">=</span> <span class="fl">10000</span></span>
<span id="cb1-8"><a></a>x <span class="op">=</span> (<span class="fu">rand</span>(n)<span class="op">.-</span><span class="fl">0.5</span>)<span class="op">*</span><span class="fl">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="type-stable-example-1" class="slide level2">
<h2>Type Stable: Example</h2>
<div class="columns">
<div class="column" style="width:33%;">
<p>Stable: Float to Float</p>
<div id="95f33eb0" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a></a><span class="pp">@benchmark</span> <span class="fu">unstabletrick</span>(x, <span class="fl">0</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 3 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">8.871 μs</span> … <span class="ansi-magenta-fg"> 18.885 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">8.878 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">9.033 μs</span> ± <span class="ansi-green-fg">552.938 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  <span class="ansi-blue-fg">█</span>▁     <span class="ansi-green-fg"> </span>               ▅▃           ▃                       ▁
  <span class="ansi-blue-fg">█</span>█▆▅▅▅▄<span class="ansi-green-fg">▄</span>▅▃▄▃▁▁▅▄▃▁▁▃▃▁▁██▆▄▃▁▁▁▁▁▁▁▁██▅▁▁▁▁▁▁▁▃▃▃▆▇▆▅▅▃▄▃▅▄ █
  8.87 μs<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      10.3 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">16 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:33%;">
<p>Stable: Int to Int</p>
<div id="ef4eef3e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a></a>xint <span class="op">=</span> <span class="fu">round</span>.(<span class="dt">Int</span>, x)</span>
<span id="cb3-2"><a></a><span class="pp">@benchmark</span> <span class="fu">unstabletrick</span>(xint, <span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 10 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">1.754 μs</span> … <span class="ansi-magenta-fg"> 59.280 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">1.774 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">1.801 μs</span> ± <span class="ansi-green-fg">586.764 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
    ▁▇█<span class="ansi-blue-fg">▅</span>     <span class="ansi-green-fg"> </span>                                                 
  ▂▄███<span class="ansi-blue-fg">█</span>█▅▃▂▂<span class="ansi-green-fg">▂</span>▂▂▂▂▂▁▂▁▂▁▁▁▂▂▂▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▂▂▁▂▂▁▂▂ ▃
  1.75 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>           2 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">16 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:33%;">
<p>Unstable: (Int &amp; Float) to (Int | Float)</p>
<div id="b9340c0b" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a></a><span class="pp">@benchmark</span> <span class="fu">unstabletrick</span>(xint, <span class="fl">0</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">54.078 μs</span> … <span class="ansi-magenta-fg">104.830 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">58.656 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">58.734 μs</span> ± <span class="ansi-green-fg">  4.148 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
     ▁▂      ▁<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">█</span>▂                                               
  ▂▃▆███▇▅▃▃▄█<span class="ansi-blue-fg">█</span><span class="ansi-green-fg">█</span>█▆▄▃▃▃▂▂▂▂▃▂▂▂▂▂▂▂▂▁▂▁▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂ ▃
  54.1 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>         76.4 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">16 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1</span>.</pre>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>6-32x slowdown!</li>
</ul>
</section>
<section id="detecting-type-instability" class="slide level2">
<h2>Detecting Type Instability</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div id="f9fc254b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a></a><span class="pp">@code_warntype</span> <span class="fu">unstabletrick</span>(xint,<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for unstabletrick(::Vector{Int64}, ::Int64)
  from unstabletrick(x, t) @ Main In[2]:2
Arguments
  #self#::Core.Const(unstabletrick)
  x::Vector{Int64}
  t::Int64
Locals
  #13::var"#13#14"{Int64}
Body::Int64
1 ─ %1 = Main.:(var"#13#14")::Core.Const(var"#13#14")
│   %2 = Core.typeof(t)::Core.Const(Int64)
│   %3 = Core.apply_type(%1, %2)::Core.Const(var"#13#14"{Int64})
│        (#13 = %new(%3, t))
│   %5 = #13::var"#13#14"{Int64}
│   %6 = Base.Generator(%5, x)::Base.Generator{Vector{Int64}, var"#13#14"{Int64}}
│   %7 = Main.sum(%6)::Int64
└──      return %7
</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="40b2501b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a></a><span class="pp">@code_warntype</span> <span class="fu">unstabletrick</span>(xint,<span class="fl">0</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for unstabletrick(::Vector{Int64}, ::Float64)
  from unstabletrick(x, t) @ Main In[2]:2
Arguments
  #self#::Core.Const(unstabletrick)
  x::Vector{Int64}
  t::Float64
Locals
  #13::var"#13#14"{Float64}
Body::Union{Float64, Int64}
1 ─ %1 = Main.:(var"#13#14")::Core.Const(var"#13#14")
│   %2 = Core.typeof(t)::Core.Const(Float64)
│   %3 = Core.apply_type(%1, %2)::Core.Const(var"#13#14"{Float64})
│        (#13 = %new(%3, t))
│   %5 = #13::var"#13#14"{Float64}
│   %6 = Base.Generator(%5, x)::Base.Generator{Vector{Int64}, var"#13#14"{Float64}}
│   %7 = Main.sum(%6)::Union{Float64, Int64}
└──      return %7
</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="extended-example" class="slide level2">
<h2>Extended Example</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div id="19c01c05" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code for klm()</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a></a><span class="im">using</span> <span class="bu">ForwardDiff</span>, <span class="bu">LinearAlgebra</span>, <span class="bu">Distributions</span></span>
<span id="cb9-2"><a></a><span class="kw">function</span> <span class="fu">statparts</span>(gi<span class="op">::</span><span class="dt">Function</span>)</span>
<span id="cb9-3"><a></a>  <span class="kw">function</span> <span class="fu">P</span>(A) <span class="co"># projection matrix</span></span>
<span id="cb9-4"><a></a>    <span class="fu">A*pinv</span>(A<span class="op">'*</span>A)<span class="op">*</span>A<span class="op">'</span></span>
<span id="cb9-5"><a></a>  <span class="kw">end</span></span>
<span id="cb9-6"><a></a>  <span class="kw">function</span>(θ)</span>
<span id="cb9-7"><a></a>    giθ <span class="op">=</span> <span class="fu">gi</span>(θ)</span>
<span id="cb9-8"><a></a>    p <span class="op">=</span> <span class="fu">length</span>(θ)</span>
<span id="cb9-9"><a></a>    (n, k) <span class="op">=</span> <span class="fu">size</span>(giθ)</span>
<span id="cb9-10"><a></a>    Ω <span class="op">=</span> <span class="fu">cov</span>(giθ)</span>
<span id="cb9-11"><a></a>    gn<span class="op">=</span><span class="fu">mean</span>(<span class="fu">gi</span>(θ), dims<span class="op">=</span><span class="fl">1</span>)<span class="ch">'</span></span>
<span id="cb9-12"><a></a>    Gi<span class="op">=</span> ForwardDiff.<span class="fu">jacobian</span>(gi,θ)</span>
<span id="cb9-13"><a></a>    Gi <span class="op">=</span> <span class="fu">reshape</span>(Gi, n , k, p)</span>
<span id="cb9-14"><a></a>    G <span class="op">=</span> <span class="fu">mean</span>(Gi, dims<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb9-15"><a></a>    Γ <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">eltype</span>(Gi),p,k,k)</span>
<span id="cb9-16"><a></a>    D <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">eltype</span>(Gi),k, p)</span>
<span id="cb9-17"><a></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>p</span>
<span id="cb9-18"><a></a>      <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb9-19"><a></a>        Γ[j,<span class="op">:</span>,<span class="op">:</span>] <span class="op">+=</span> (Gi[i,<span class="op">:</span>,j] <span class="op">.-</span> G[<span class="fl">1</span>,<span class="op">:</span>,j]) <span class="op">*</span> giθ[i,<span class="op">:</span>]<span class="ch">'</span></span>
<span id="cb9-20"><a></a>      <span class="cf">end</span></span>
<span id="cb9-21"><a></a>      Γ[j,<span class="op">:</span>,<span class="op">:</span>] <span class="op">./=</span> n</span>
<span id="cb9-22"><a></a>      D[<span class="op">:</span>,j] <span class="op">=</span> G[<span class="fl">1</span>,<span class="op">:</span>,j] <span class="op">-</span> Γ[j,<span class="op">:</span>,<span class="op">:</span>]<span class="fu">*inv</span>(Ω)<span class="op">*</span>gn</span>
<span id="cb9-23"><a></a>    <span class="cf">end</span></span>
<span id="cb9-24"><a></a>    <span class="cf">return</span>(n,k,p,gn, Ω, D, P)</span>
<span id="cb9-25"><a></a>  <span class="kw">end</span></span>
<span id="cb9-26"><a></a><span class="kw">end</span></span>
<span id="cb9-27"><a></a></span>
<span id="cb9-28"><a></a><span class="kw">function</span> <span class="fu">klm</span>(gi<span class="op">::</span><span class="dt">Function</span>)</span>
<span id="cb9-29"><a></a>  SP <span class="op">=</span> <span class="fu">statparts</span>(gi)</span>
<span id="cb9-30"><a></a>  <span class="kw">function</span>(θ)</span>
<span id="cb9-31"><a></a>    (n,k,p,gn, Ω, D, P) <span class="op">=</span> <span class="fu">SP</span>(θ)</span>
<span id="cb9-32"><a></a>    <span class="cf">return</span> <span class="fu">n*</span>(gn<span class="op">'*</span>Ω<span class="op">^</span>(<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>)<span class="fu">*P</span>(Ω<span class="op">^</span>(<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>)<span class="op">*</span>D)<span class="op">*</span>Ω<span class="op">^</span>(<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>)<span class="op">*</span>gn)[<span class="fl">1</span>]</span>
<span id="cb9-33"><a></a>  <span class="kw">end</span></span>
<span id="cb9-34"><a></a><span class="kw">end</span></span>
<span id="cb9-35"><a></a></span>
<span id="cb9-36"><a></a><span class="im">import</span> <span class="bu">Random</span></span>
<span id="cb9-37"><a></a><span class="kw">function</span> <span class="fu">simulate_ivshare</span>(n,β,γ,ρ)</span>
<span id="cb9-38"><a></a>  z <span class="op">=</span> <span class="fu">randn</span>(n, <span class="fu">size</span>(γ)[<span class="fl">1</span>])</span>
<span id="cb9-39"><a></a>  endo <span class="op">=</span> <span class="fu">randn</span>(n, <span class="fu">length</span>(β))</span>
<span id="cb9-40"><a></a>  x <span class="op">=</span> z<span class="op">*</span>γ <span class="op">.+</span> endo</span>
<span id="cb9-41"><a></a>  ξ <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">Normal</span>(<span class="fl">0</span>,<span class="fu">sqrt</span>((<span class="fl">1.0</span><span class="op">-</span>ρ<span class="op">^</span><span class="fl">2</span>))),n)<span class="op">.+</span>endo[<span class="op">:</span>,<span class="fl">1</span>]<span class="op">*</span>ρ</span>
<span id="cb9-42"><a></a>  y <span class="op">=</span> <span class="fu">cdf</span>.(<span class="fu">Logistic</span>(), x<span class="op">*</span>β <span class="op">.+</span> ξ)</span>
<span id="cb9-43"><a></a>  <span class="cf">return</span>((y<span class="op">=</span>y,x<span class="op">=</span>x,z<span class="op">=</span>z))</span>
<span id="cb9-44"><a></a><span class="kw">end</span></span>
<span id="cb9-45"><a></a>n <span class="op">=</span> <span class="fl">100</span></span>
<span id="cb9-46"><a></a>k <span class="op">=</span> <span class="fl">2</span></span>
<span id="cb9-47"><a></a>iv <span class="op">=</span> <span class="fl">3</span></span>
<span id="cb9-48"><a></a>β<span class="fl">0</span> <span class="op">=</span> <span class="fu">ones</span>(k)</span>
<span id="cb9-49"><a></a>π<span class="fl">0</span> <span class="op">=</span> <span class="fu">vcat</span>(<span class="fl">5</span><span class="op">*</span>I,<span class="fu">ones</span>(iv<span class="op">-</span>k,k))</span>
<span id="cb9-50"><a></a>ρ <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb9-51"><a></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">622</span>)</span>
<span id="cb9-52"><a></a>(y,x,z) <span class="op">=</span> <span class="fu">simulate_ivshare</span>(n,β<span class="fl">0</span>,π<span class="fl">0</span>,ρ)</span>
<span id="cb9-53"><a></a></span>
<span id="cb9-54"><a></a><span class="kw">function</span> <span class="fu">gi_ivshare</span>(β,y,x,z)</span>
<span id="cb9-55"><a></a>  ξ <span class="op">=</span> <span class="fu">quantile</span>.(<span class="fu">Logistic</span>(),y) <span class="op">.-</span> x<span class="op">*</span>β</span>
<span id="cb9-56"><a></a>  ξ<span class="op">.*</span>z</span>
<span id="cb9-57"><a></a><span class="kw">end</span></span>
<span id="cb9-58"><a></a></span>
<span id="cb9-59"><a></a>gi <span class="op">=</span> <span class="kw">let</span> y<span class="op">=</span>y, x<span class="op">=</span>x, z<span class="op">=</span>z</span>
<span id="cb9-60"><a></a>  <span class="fu">β-&gt;gi_ivshare</span>(β,y,x,z)</span>
<span id="cb9-61"><a></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>#20 (generic function with 1 method)</code></pre>
</div>
</div>
<div id="5f65d120" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a></a><span class="pp">@code_warntype</span> <span class="fu">statparts</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for (::var"#15#17"{var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}, var"#P#16"})(::Vector{Float64})
  from (::var"#15#17")(θ) @ Main In[8]:6
Arguments
  #self#::var"#15#17"{var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}, var"#P#16"}
  θ::Vector{Float64}
Locals
  @_3::Union{Nothing, Tuple{Int64, Int64}}
  @_4::Int64
  D::Union{Array{Float64, 3}, Matrix}
  Γ::Union{Array{Float64, 4}, Array{_A, 3} where _A}
  G::Any
  Gi::Any
  gn::Adjoint{Float64, Matrix{Float64}}
  Ω::Matrix{Float64}
  k::Int64
  n::Int64
  p::Int64
  giθ::Matrix{Float64}
  @_15::Union{Nothing, Tuple{Int64, Int64}}
  j::Int64
  i::Int64
Body::Tuple{Int64, Int64, Int64, Adjoint{Float64, Matrix{Float64}}, Matrix{Float64}, Union{Array{Float64, 3}, Matrix}, var"#P#16"}
1 ─ %1  = Core.getfield(#self#, :gi)::var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}
│         (giθ = (%1)(θ))
│         (p = Main.length(θ))
│   %4  = Main.size(giθ)::Tuple{Int64, Int64}
│   %5  = Base.indexed_iterate(%4, 1)::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(2)])
│         (n = Core.getfield(%5, 1))
│         (@_4 = Core.getfield(%5, 2))
│   %8  = Base.indexed_iterate(%4, 2, @_4::Core.Const(2))::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(3)])
│         (k = Core.getfield(%8, 1))
│         (Ω = Main.cov(giθ))
│   %11 = Core.getfield(#self#, :gi)::var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}
│   %12 = (%11)(θ)::Matrix{Float64}
│   %13 = (:dims,)::Core.Const((:dims,))
│   %14 = Core.apply_type(Core.NamedTuple, %13)::Core.Const(NamedTuple{(:dims,)})
│   %15 = Core.tuple(1)::Core.Const((1,))
│   %16 = (%14)(%15)::Core.Const((dims = 1,))
│   %17 = Core.kwcall(%16, Main.mean, %12)::Matrix{Float64}
│         (gn = Main.:var"'"(%17))
│   %19 = ForwardDiff.jacobian::Core.Const(ForwardDiff.jacobian)
│   %20 = Core.getfield(#self#, :gi)::var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}
│         (Gi = (%19)(%20, θ))
│         (Gi = Main.reshape(Gi, n, k, p))
│   %23 = (:dims,)::Core.Const((:dims,))
│   %24 = Core.apply_type(Core.NamedTuple, %23)::Core.Const(NamedTuple{(:dims,)})
│   %25 = Core.tuple(1)::Core.Const((1,))
│   %26 = (%24)(%25)::Core.Const((dims = 1,))
│         (G = Core.kwcall(%26, Main.mean, Gi))
│   %28 = Main.eltype(Gi)::Any
│   %29 = p::Int64
│   %30 = k::Int64
│         (Γ = Main.zeros(%28, %29, %30, k))
│   %32 = Main.eltype(Gi)::Any
│   %33 = k::Int64
│         (D = Main.zeros(%32, %33, p))
│   %35 = (1:p)::Core.PartialStruct(UnitRange{Int64}, Any[Core.Const(1), Int64])
│         (@_3 = Base.iterate(%35))
│   %37 = (@_3 === nothing)::Bool
│   %38 = Base.not_int(%37)::Bool
└──       goto #7 if not %38
2 ┄ %40 = @_3::Tuple{Int64, Int64}
│         (j = Core.getfield(%40, 1))
│   %42 = Core.getfield(%40, 2)::Int64
│   %43 = (1:n)::Core.PartialStruct(UnitRange{Int64}, Any[Core.Const(1), Int64])
│         (@_15 = Base.iterate(%43))
│   %45 = (@_15 === nothing)::Bool
│   %46 = Base.not_int(%45)::Bool
└──       goto #5 if not %46
3 ┄ %48 = @_15::Tuple{Int64, Int64}
│         (i = Core.getfield(%48, 1))
│   %50 = Core.getfield(%48, 2)::Int64
│   %51 = Base.getindex(Γ, j, Main.:(:), Main.:(:))::Matrix
│   %52 = Main.:-::Core.Const(-)
│   %53 = Base.getindex(Gi, i, Main.:(:), j)::Any
│   %54 = Base.getindex(G, 1, Main.:(:), j)::Any
│   %55 = Base.broadcasted(%52, %53, %54)::Any
│   %56 = Base.materialize(%55)::Any
│   %57 = Base.getindex(giθ, i, Main.:(:))::Vector{Float64}
│   %58 = Main.:var"'"(%57)::Adjoint{Float64, Vector{Float64}}
│   %59 = (%56 * %58)::Any
│   %60 = (%51 + %59)::Any
│         Base.setindex!(Γ, %60, j, Main.:(:), Main.:(:))
│         (@_15 = Base.iterate(%43, %50))
│   %63 = (@_15 === nothing)::Bool
│   %64 = Base.not_int(%63)::Bool
└──       goto #5 if not %64
4 ─       goto #3
5 ┄ %67 = Base.dotview(Γ, j, Main.:(:), Main.:(:))::SubArray{_A, 2, P, Tuple{Int64, Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}}, true} where {_A, P&lt;:(Array{_A, 3} where _A)}
│   %68 = Main.:/::Core.Const(/)
│   %69 = Base.getindex(Γ, j, Main.:(:), Main.:(:))::Matrix
│   %70 = Base.broadcasted(%68, %69, n)::Base.Broadcast.Broadcasted{Base.Broadcast.DefaultArrayStyle{2}, Nothing, typeof(/), &lt;:Tuple{Matrix, Int64}}
│         Base.materialize!(%67, %70)
│   %72 = Base.getindex(G, 1, Main.:(:), j)::Any
│   %73 = Base.getindex(Γ, j, Main.:(:), Main.:(:))::Matrix
│   %74 = Main.inv(Ω)::Matrix{Float64}
│   %75 = (%73 * %74 * gn)::Any
│   %76 = (%72 - %75)::Any
│         Base.setindex!(D, %76, Main.:(:), j)
│         (@_3 = Base.iterate(%35, %42))
│   %79 = (@_3 === nothing)::Bool
│   %80 = Base.not_int(%79)::Bool
└──       goto #7 if not %80
6 ─       goto #2
7 ┄ %83 = n::Int64
│   %84 = k::Int64
│   %85 = p::Int64
│   %86 = gn::Adjoint{Float64, Matrix{Float64}}
│   %87 = Ω::Matrix{Float64}
│   %88 = D::Union{Array{Float64, 3}, Matrix}
│   %89 = Core.getfield(#self#, :P)::Core.Const(var"#P#16"())
│   %90 = Core.tuple(%83, %84, %85, %86, %87, %88, %89)::Tuple{Int64, Int64, Int64, Adjoint{Float64, Matrix{Float64}}, Matrix{Float64}, Union{Array{Float64, 3}, Matrix}, var"#P#16"}
└──       return %90
</code></pre>
</div>
</div>
<div id="4bf8f239" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a></a><span class="pp">@benchmark</span> <span class="fu">statparts</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 8836 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">517.217 μs</span> … <span class="ansi-magenta-fg">  5.395 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 85.98%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">535.143 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">559.969 μs</span> ± <span class="ansi-green-fg">280.016 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>3.40% ±  5.98%
    ▂▄▆▇███<span class="ansi-blue-fg">▇</span>▇▆▆▅▅▄▄▃▃▂▂<span class="ansi-green-fg">▁</span>▂▁▁▁                                    ▃
  ▄▆███████<span class="ansi-blue-fg">█</span>███████████<span class="ansi-green-fg">█</span>██████▇████▇▇▇▆▇▇▇▇▇▇▆▇▆▆▆▅▆▆▆▅▄▅▇▆▅▄▅▄ █
  517 μs<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>        641 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">221.16 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">3910</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="5b98f7f9" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>klm_stable()</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a></a><span class="kw">function</span> <span class="fu">statparts_stable</span>(gi<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt"> Function</span>}</span>
<span id="cb14-2"><a></a>  <span class="kw">function</span> <span class="fu">P</span>(A) <span class="co"># projection matrix</span></span>
<span id="cb14-3"><a></a>    <span class="fu">A*pinv</span>(A<span class="op">'*</span>A)<span class="op">*</span>A<span class="op">'</span></span>
<span id="cb14-4"><a></a>  <span class="kw">end</span></span>
<span id="cb14-5"><a></a>  <span class="kw">function</span>(θ)</span>
<span id="cb14-6"><a></a>    giθ <span class="op">=</span> <span class="fu">gi</span>(θ)</span>
<span id="cb14-7"><a></a>    p <span class="op">=</span> <span class="fu">length</span>(θ)</span>
<span id="cb14-8"><a></a>    (n, k) <span class="op">=</span> <span class="fu">size</span>(giθ)</span>
<span id="cb14-9"><a></a>    Ω <span class="op">=</span> <span class="fu">cov</span>(giθ)</span>
<span id="cb14-10"><a></a>    gn<span class="op">=</span><span class="fu">mean</span>(<span class="fu">gi</span>(θ), dims<span class="op">=</span><span class="fl">1</span>)<span class="ch">'</span></span>
<span id="cb14-11"><a></a>    Gi <span class="op">=</span> <span class="fu">similar</span>(gn,n,k,p)</span>
<span id="cb14-12"><a></a>    Gi<span class="op">=</span> ForwardDiff.<span class="fu">jacobian!</span>(Gi,gi,θ)</span>
<span id="cb14-13"><a></a>    G <span class="op">=</span> <span class="fu">mean</span>(Gi, dims<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb14-14"><a></a>    Γ <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">eltype</span>(Gi),p,k,k)</span>
<span id="cb14-15"><a></a>    D <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">eltype</span>(Gi),k, p)</span>
<span id="cb14-16"><a></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>p</span>
<span id="cb14-17"><a></a>      <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb14-18"><a></a>        Γ[j,<span class="op">:</span>,<span class="op">:</span>] <span class="op">+=</span> (Gi[i,<span class="op">:</span>,j] <span class="op">.-</span> G[<span class="fl">1</span>,<span class="op">:</span>,j]) <span class="op">*</span> giθ[i,<span class="op">:</span>]<span class="ch">'</span></span>
<span id="cb14-19"><a></a>      <span class="cf">end</span></span>
<span id="cb14-20"><a></a>      Γ[j,<span class="op">:</span>,<span class="op">:</span>] <span class="op">./=</span> n</span>
<span id="cb14-21"><a></a>      D[<span class="op">:</span>,j] <span class="op">=</span> G[<span class="fl">1</span>,<span class="op">:</span>,j] <span class="op">-</span> Γ[j,<span class="op">:</span>,<span class="op">:</span>]<span class="fu">*inv</span>(Ω)<span class="op">*</span>gn</span>
<span id="cb14-22"><a></a>    <span class="cf">end</span></span>
<span id="cb14-23"><a></a>    <span class="cf">return</span>(n,k,p,gn, Ω, D, P)</span>
<span id="cb14-24"><a></a>  <span class="kw">end</span></span>
<span id="cb14-25"><a></a><span class="kw">end</span></span>
<span id="cb14-26"><a></a></span>
<span id="cb14-27"><a></a><span class="kw">function</span> <span class="fu">klm_stable</span>(gi<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt"> Function</span>}</span>
<span id="cb14-28"><a></a>  SP <span class="op">=</span> <span class="fu">statparts_stable</span>(gi)</span>
<span id="cb14-29"><a></a>  <span class="kw">function</span>(θ)</span>
<span id="cb14-30"><a></a>    (n,k,p,gn, Ω, D, P) <span class="op">=</span> <span class="fu">SP</span>(θ)</span>
<span id="cb14-31"><a></a>    λ, v <span class="op">=</span> <span class="fu">eigen</span>(Ω)</span>
<span id="cb14-32"><a></a>    irΩ <span class="op">=</span> <span class="fu">v*diagm</span>(λ<span class="op">.^</span>(<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>))<span class="op">*</span>v<span class="op">'</span></span>
<span id="cb14-33"><a></a>    <span class="cf">return</span> <span class="fu">n*</span>(gn<span class="op">'</span><span class="fu">*irΩ*P</span>(irΩ<span class="op">*</span>D)<span class="op">*</span>irΩ<span class="op">*</span>gn)[<span class="fl">1</span>]</span>
<span id="cb14-34"><a></a>  <span class="kw">end</span></span>
<span id="cb14-35"><a></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>klm_stable (generic function with 1 method)</code></pre>
</div>
</div>
<div id="c6f26190" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a></a><span class="pp">@code_warntype</span> <span class="fu">statparts_stable</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MethodInstance for (::var"#22#24"{var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}, var"#P#23"})(::Vector{Float64})
  from (::var"#22#24")(θ) @ Main In[11]:5
Arguments
  #self#::var"#22#24"{var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}, var"#P#23"}
  θ::Vector{Float64}
Locals
  @_3::Union{Nothing, Tuple{Int64, Int64}}
  @_4::Int64
  D::Matrix{Float64}
  Γ::Array{Float64, 3}
  G::Array{Float64, 3}
  Gi::Array{Float64, 3}
  gn::Adjoint{Float64, Matrix{Float64}}
  Ω::Matrix{Float64}
  k::Int64
  n::Int64
  p::Int64
  giθ::Matrix{Float64}
  @_15::Union{Nothing, Tuple{Int64, Int64}}
  j::Int64
  i::Int64
Body::Tuple{Int64, Int64, Int64, Adjoint{Float64, Matrix{Float64}}, Matrix{Float64}, Matrix{Float64}, var"#P#23"}
1 ─ %1  = Core.getfield(#self#, :gi)::var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}
│         (giθ = (%1)(θ))
│         (p = Main.length(θ))
│   %4  = Main.size(giθ)::Tuple{Int64, Int64}
│   %5  = Base.indexed_iterate(%4, 1)::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(2)])
│         (n = Core.getfield(%5, 1))
│         (@_4 = Core.getfield(%5, 2))
│   %8  = Base.indexed_iterate(%4, 2, @_4::Core.Const(2))::Core.PartialStruct(Tuple{Int64, Int64}, Any[Int64, Core.Const(3)])
│         (k = Core.getfield(%8, 1))
│         (Ω = Main.cov(giθ))
│   %11 = Core.getfield(#self#, :gi)::var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}
│   %12 = (%11)(θ)::Matrix{Float64}
│   %13 = (:dims,)::Core.Const((:dims,))
│   %14 = Core.apply_type(Core.NamedTuple, %13)::Core.Const(NamedTuple{(:dims,)})
│   %15 = Core.tuple(1)::Core.Const((1,))
│   %16 = (%14)(%15)::Core.Const((dims = 1,))
│   %17 = Core.kwcall(%16, Main.mean, %12)::Matrix{Float64}
│         (gn = Main.:var"'"(%17))
│         (Gi = Main.similar(gn, n, k, p))
│   %20 = ForwardDiff.jacobian!::Core.Const(ForwardDiff.jacobian!)
│   %21 = Gi::Array{Float64, 3}
│   %22 = Core.getfield(#self#, :gi)::var"#20#21"{Vector{Float64}, Matrix{Float64}, Matrix{Float64}}
│         (Gi = (%20)(%21, %22, θ))
│   %24 = (:dims,)::Core.Const((:dims,))
│   %25 = Core.apply_type(Core.NamedTuple, %24)::Core.Const(NamedTuple{(:dims,)})
│   %26 = Core.tuple(1)::Core.Const((1,))
│   %27 = (%25)(%26)::Core.Const((dims = 1,))
│         (G = Core.kwcall(%27, Main.mean, Gi))
│   %29 = Main.eltype(Gi)::Core.Const(Float64)
│   %30 = p::Int64
│   %31 = k::Int64
│         (Γ = Main.zeros(%29, %30, %31, k))
│   %33 = Main.eltype(Gi)::Core.Const(Float64)
│   %34 = k::Int64
│         (D = Main.zeros(%33, %34, p))
│   %36 = (1:p)::Core.PartialStruct(UnitRange{Int64}, Any[Core.Const(1), Int64])
│         (@_3 = Base.iterate(%36))
│   %38 = (@_3 === nothing)::Bool
│   %39 = Base.not_int(%38)::Bool
└──       goto #7 if not %39
2 ┄ %41 = @_3::Tuple{Int64, Int64}
│         (j = Core.getfield(%41, 1))
│   %43 = Core.getfield(%41, 2)::Int64
│   %44 = (1:n)::Core.PartialStruct(UnitRange{Int64}, Any[Core.Const(1), Int64])
│         (@_15 = Base.iterate(%44))
│   %46 = (@_15 === nothing)::Bool
│   %47 = Base.not_int(%46)::Bool
└──       goto #5 if not %47
3 ┄ %49 = @_15::Tuple{Int64, Int64}
│         (i = Core.getfield(%49, 1))
│   %51 = Core.getfield(%49, 2)::Int64
│   %52 = Base.getindex(Γ, j, Main.:(:), Main.:(:))::Matrix{Float64}
│   %53 = Main.:-::Core.Const(-)
│   %54 = Base.getindex(Gi, i, Main.:(:), j)::Vector{Float64}
│   %55 = Base.getindex(G, 1, Main.:(:), j)::Vector{Float64}
│   %56 = Base.broadcasted(%53, %54, %55)::Base.Broadcast.Broadcasted{Base.Broadcast.DefaultArrayStyle{1}, Nothing, typeof(-), Tuple{Vector{Float64}, Vector{Float64}}}
│   %57 = Base.materialize(%56)::Vector{Float64}
│   %58 = Base.getindex(giθ, i, Main.:(:))::Vector{Float64}
│   %59 = Main.:var"'"(%58)::Adjoint{Float64, Vector{Float64}}
│   %60 = (%57 * %59)::Matrix{Float64}
│   %61 = (%52 + %60)::Matrix{Float64}
│         Base.setindex!(Γ, %61, j, Main.:(:), Main.:(:))
│         (@_15 = Base.iterate(%44, %51))
│   %64 = (@_15 === nothing)::Bool
│   %65 = Base.not_int(%64)::Bool
└──       goto #5 if not %65
4 ─       goto #3
5 ┄ %68 = Base.dotview(Γ, j, Main.:(:), Main.:(:))::SubArray{Float64, 2, Array{Float64, 3}, Tuple{Int64, Base.Slice{Base.OneTo{Int64}}, Base.Slice{Base.OneTo{Int64}}}, true}
│   %69 = Main.:/::Core.Const(/)
│   %70 = Base.getindex(Γ, j, Main.:(:), Main.:(:))::Matrix{Float64}
│   %71 = Base.broadcasted(%69, %70, n)::Base.Broadcast.Broadcasted{Base.Broadcast.DefaultArrayStyle{2}, Nothing, typeof(/), Tuple{Matrix{Float64}, Int64}}
│         Base.materialize!(%68, %71)
│   %73 = Base.getindex(G, 1, Main.:(:), j)::Vector{Float64}
│   %74 = Base.getindex(Γ, j, Main.:(:), Main.:(:))::Matrix{Float64}
│   %75 = Main.inv(Ω)::Matrix{Float64}
│   %76 = (%74 * %75 * gn)::Matrix{Float64}
│   %77 = (%73 - %76)::Matrix{Float64}
│         Base.setindex!(D, %77, Main.:(:), j)
│         (@_3 = Base.iterate(%36, %43))
│   %80 = (@_3 === nothing)::Bool
│   %81 = Base.not_int(%80)::Bool
└──       goto #7 if not %81
6 ─       goto #2
7 ┄ %84 = n::Int64
│   %85 = k::Int64
│   %86 = p::Int64
│   %87 = gn::Adjoint{Float64, Matrix{Float64}}
│   %88 = Ω::Matrix{Float64}
│   %89 = D::Matrix{Float64}
│   %90 = Core.getfield(#self#, :P)::Core.Const(var"#P#23"())
│   %91 = Core.tuple(%84, %85, %86, %87, %88, %89, %90)::Tuple{Int64, Int64, Int64, Adjoint{Float64, Matrix{Float64}}, Matrix{Float64}, Matrix{Float64}, var"#P#23"}
└──       return %91
</code></pre>
</div>
</div>
<div id="5132e94c" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a></a><span class="pp">@benchmark</span> <span class="fu">statparts_stable</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold"> 98.690 μs</span> … <span class="ansi-magenta-fg">  3.815 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 95.52%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">114.054 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">128.470 μs</span> ± <span class="ansi-green-fg">207.603 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>9.79% ±  5.84%
        ▁▃▃▄▄▇███▇<span class="ansi-blue-fg">▇</span>▆▅▄▃▂▁       <span class="ansi-green-fg"> </span>                                
  ▂▂▃▄▅▇██████████<span class="ansi-blue-fg">█</span>███████▇▇▆▅▅▅<span class="ansi-green-fg">▄</span>▃▃▃▃▃▃▃▃▃▃▃▃▂▃▃▂▂▂▂▂▂▂▂▂▂▂▁▂▂▂ ▄
  98.7 μs<span class="ansi-bright-black-fg">          Histogram: frequency by time</span>          158 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">173.17 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1466</span>.</pre>
</div>
</div>
</div>
<div id="43f09237" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a></a><span class="im">using</span> <span class="bu">Test</span></span>
<span id="cb19-2"><a></a><span class="pp">@test</span> <span class="fu">klm</span>(gi)(β<span class="fl">0</span>) <span class="op">≈</span> <span class="fu">klm_stable</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">Test Passed</span></pre>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>See <a href="https://schrimpf.github.io/ARGridBootstrap.jl/assignment.html#statparts">https://schrimpf.github.io/ARGridBootstrap.jl/assignment.html#statparts</a> for more information</li>
</ul>
</section></section>
<section>
<section id="targeted-optimizations" class="title-slide slide level1 center">
<h1>Targeted Optimizations</h1>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<p><img data-src="westdri_talk_files/figure-revealjs/mermaid-figure-2.png" style="width:15.91in;height:6.05in"></p>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="profiling" class="slide level2">
<h2>Profiling</h2>
<div id="fcf8f214" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>profileiframe</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a></a><span class="im">using</span> <span class="bu">Profile</span>, <span class="bu">ProfileCanvas</span></span>
<span id="cb20-2"><a></a><span class="kw">function</span> <span class="fu">profilehtmlstring</span>()</span>
<span id="cb20-3"><a></a>  buf <span class="op">=</span> <span class="fu">IOBuffer</span>()</span>
<span id="cb20-4"><a></a>  <span class="fu">show</span>(buf, <span class="fu">MIME</span>(<span class="st">"text/html"</span>), ProfileCanvas.<span class="fu">view</span>(<span class="bu">Profile</span>.<span class="fu">fetch</span>()))</span>
<span id="cb20-5"><a></a>  s<span class="op">=</span><span class="fu">String</span>(<span class="fu">take!</span>(buf))</span>
<span id="cb20-6"><a></a>  <span class="fu">println</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">&lt;br&gt;&lt;br&gt;</span><span class="sc">\n</span><span class="st">"</span><span class="op">*</span>s<span class="op">*</span><span class="st">"</span><span class="sc">\n</span><span class="st">&lt;br&gt;</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-7"><a></a><span class="kw">end</span></span>
<span id="cb20-8"><a></a><span class="kw">function</span> <span class="fu">profileiframe</span>(filename<span class="op">=</span><span class="st">"proftmp.html"</span>)</span>
<span id="cb20-9"><a></a>  <span class="co">#buf = IOBuffer()</span></span>
<span id="cb20-10"><a></a>  <span class="co">#show(buf, MIME("text/html"), ProfileCanvas.view(Profile.fetch()))</span></span>
<span id="cb20-11"><a></a>  <span class="co">#s=String(take!(buf))</span></span>
<span id="cb20-12"><a></a>  <span class="co">#s=replace(s, "\"" =&gt; "&amp;quot" )</span></span>
<span id="cb20-13"><a></a>  <span class="co">#  HTML("&lt;iframe srcdata=\""*s*"\" width=\"1200\"  height=\"650\"&gt;&lt;/iframe&gt;\n")</span></span>
<span id="cb20-14"><a></a>  ProfileCanvas.<span class="fu">html_file</span>(filename)</span>
<span id="cb20-15"><a></a>  <span class="fu">HTML</span>(<span class="st">"&lt;iframe src=</span><span class="sc">\"</span><span class="st">"</span><span class="op">*</span>filename<span class="op">*</span><span class="st">"</span><span class="sc">\"</span><span class="st"> width=</span><span class="sc">\"</span><span class="st">1200</span><span class="sc">\"</span><span class="st">  height=</span><span class="sc">\"</span><span class="st">650</span><span class="sc">\"</span><span class="st">&gt;&lt;/iframe&gt;</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb20-16"><a></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a></a><span class="bu">Profile</span>.<span class="fu">clear</span>();</span>
<span id="cb21-2"><a></a><span class="bu">Profile</span>.<span class="fu">init</span>(n<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>,delay<span class="op">=</span><span class="fl">0.00001</span>);</span>
<span id="cb21-3"><a></a><span class="pp">@profile</span> <span class="fu">sum</span>(<span class="fu">klm_stable</span>(gi)(β<span class="fl">0</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>)</span>
<span id="cb21-4"><a></a><span class="fu">profileiframe</span>(<span class="st">"klmprof.html"</span>) <span class="co"># only needed for quarto, just use @profview elsewhere</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<iframe src="klmprof.html" width="1200" height="650"></iframe>
</section>
<section id="reducing-allocations" class="slide level2">
<h2>Reducing Allocations</h2>
<ul>
<li>Allocating memory is slow</li>
<li>Reduce allocations by:
<ul>
<li>Using <code>@views</code> instead of slices</li>
<li>Pre-allocating and reusing arrays</li>
<li>Eliminate dynamic allocations with <code>StaticArrays</code> or similar compile time known size types</li>
</ul></li>
</ul>
</section>
<section id="reduced-allocations" class="slide level2">
<h2>Reduced Allocations</h2>
<div id="1a731f07" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>klm_fast()</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a></a><span class="kw">function</span> <span class="fu">statparts_fast</span>(gi<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt"> Function</span>}</span>
<span id="cb22-2"><a></a>  <span class="kw">function</span> <span class="fu">P</span>(A<span class="op">::</span><span class="dt">AbstractMatrix</span>) <span class="co"># projection matrix</span></span>
<span id="cb22-3"><a></a>    <span class="fu">A*pinv</span>(A<span class="op">'*</span>A)<span class="op">*</span>A<span class="op">'</span></span>
<span id="cb22-4"><a></a>  <span class="kw">end</span></span>
<span id="cb22-5"><a></a>  <span class="kw">let</span> gi<span class="op">=</span>gi</span>
<span id="cb22-6"><a></a>    <span class="kw">function</span>(θ)</span>
<span id="cb22-7"><a></a>      giθ <span class="op">=</span> <span class="fu">gi</span>(θ)</span>
<span id="cb22-8"><a></a>      p <span class="op">=</span> <span class="fu">length</span>(θ)</span>
<span id="cb22-9"><a></a>      (n, k) <span class="op">=</span> <span class="fu">size</span>(giθ)</span>
<span id="cb22-10"><a></a>      Ω <span class="op">=</span> <span class="fu">Hermitian</span>(<span class="fu">cov</span>(giθ))</span>
<span id="cb22-11"><a></a>      gn<span class="op">=</span><span class="fu">mean</span>(<span class="fu">gi</span>(θ), dims<span class="op">=</span><span class="fl">1</span>)<span class="ch">'</span></span>
<span id="cb22-12"><a></a>      iΩgn <span class="op">=</span> Ω <span class="op">\</span> gn</span>
<span id="cb22-13"><a></a>      Gi <span class="op">=</span> <span class="fu">similar</span>(gn,n,k,p)</span>
<span id="cb22-14"><a></a>      ForwardDiff.<span class="fu">jacobian!</span>(Gi,gi,θ)</span>
<span id="cb22-15"><a></a>      G <span class="op">=</span> <span class="fu">mean</span>(Gi, dims<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb22-16"><a></a>      Γ <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">eltype</span>(Gi),p,k,k)</span>
<span id="cb22-17"><a></a>      D <span class="op">=</span> <span class="fu">zeros</span>(<span class="fu">eltype</span>(Gi),k, p)</span>
<span id="cb22-18"><a></a>      <span class="pp">@inbounds</span> <span class="cf">for</span> j <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>p</span>
<span id="cb22-19"><a></a>        <span class="pp">@inbounds</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb22-20"><a></a>          <span class="pp">@views</span> Γ[j,<span class="op">:</span>,<span class="op">:</span>] <span class="op">.+=</span> (Gi[i,<span class="op">:</span>,j] <span class="op">.-</span> G[<span class="fl">1</span>,<span class="op">:</span>,j]) <span class="op">*</span> giθ[i,<span class="op">:</span>]<span class="ch">'</span></span>
<span id="cb22-21"><a></a>        <span class="cf">end</span></span>
<span id="cb22-22"><a></a>        Γ[j,<span class="op">:</span>,<span class="op">:</span>] <span class="op">./=</span> n</span>
<span id="cb22-23"><a></a>        <span class="pp">@views</span> D[<span class="op">:</span>,j] <span class="op">.=</span> G[<span class="fl">1</span>,<span class="op">:</span>,j] <span class="op">.-</span> Γ[j,<span class="op">:</span>,<span class="op">:</span>]<span class="op">*</span>iΩgn</span>
<span id="cb22-24"><a></a>      <span class="cf">end</span></span>
<span id="cb22-25"><a></a>      <span class="cf">return</span>(n,k,p,gn, Ω, D, P)</span>
<span id="cb22-26"><a></a>    <span class="kw">end</span></span>
<span id="cb22-27"><a></a>  <span class="kw">end</span></span>
<span id="cb22-28"><a></a><span class="kw">end</span></span>
<span id="cb22-29"><a></a></span>
<span id="cb22-30"><a></a><span class="kw">function</span> <span class="fu">klm_fast</span>(gi<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt"> Function</span>}</span>
<span id="cb22-31"><a></a>  SP <span class="op">=</span> <span class="fu">statparts_fast</span>(gi)</span>
<span id="cb22-32"><a></a>  <span class="kw">function</span>(θ)</span>
<span id="cb22-33"><a></a>    (n,k,p,gn, Ω, D, P) <span class="op">=</span> <span class="fu">SP</span>(θ)</span>
<span id="cb22-34"><a></a>    λ, v <span class="op">=</span> <span class="fu">eigen</span>(Ω)</span>
<span id="cb22-35"><a></a>    irΩ <span class="op">=</span> <span class="fu">v*diagm</span>(λ<span class="op">.^</span>(<span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>))<span class="op">*</span>v<span class="op">'</span></span>
<span id="cb22-36"><a></a>    <span class="cf">return</span> <span class="fu">n*</span>(gn<span class="op">'</span><span class="fu">*irΩ*P</span>(irΩ<span class="op">*</span>D)<span class="op">*</span>irΩ<span class="op">*</span>gn)[<span class="fl">1</span>]</span>
<span id="cb22-37"><a></a>  <span class="kw">end</span></span>
<span id="cb22-38"><a></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>klm_fast (generic function with 1 method)</code></pre>
</div>
</div>
<div id="022d40ce" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a></a><span class="pp">@benchmark</span> <span class="fu">klm_fast</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">75.089 μs</span> … <span class="ansi-magenta-fg"> 18.946 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span> 0.00% … 97.41%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">82.954 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span> 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">99.055 μs</span> ± <span class="ansi-green-fg">293.161 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>12.44% ±  4.68%
      ▄▇█<span class="ansi-blue-fg">▄</span>▁             <span class="ansi-green-fg"> </span>                                       
  ▂▃▄████<span class="ansi-blue-fg">█</span>█▇▆▅▄▄▄▃▃▃▃▃▃▂<span class="ansi-green-fg">▃</span>▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▁▂▂▂▂▂▂▂▂▂▂▂▂▂▂ ▃
  75.1 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>          142 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">118.53 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">501</span>.</pre>
</div>
</div>
</div>
<div id="4c08e489" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a></a><span class="pp">@test</span> <span class="fu">klm_fast</span>(gi)(β<span class="fl">0</span>) <span class="op">≈</span> <span class="fu">klm</span>(gi)(β<span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div class="ansi-escaped-output">
<pre><span class="ansi-green-fg ansi-bold">Test Passed</span></pre>
</div>
</div>
</div>
</section>
<section id="staticarrays" class="slide level2">
<h2>StaticArrays</h2>
<div id="d8e6d63d" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>extra functions</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a></a><span class="kw">struct</span> Integrator{Tx, Tw}</span>
<span id="cb26-2"><a></a>    x<span class="op">::</span><span class="dt">Tx</span></span>
<span id="cb26-3"><a></a>    w<span class="op">::</span><span class="dt">Tw</span></span>
<span id="cb26-4"><a></a><span class="kw">end</span></span>
<span id="cb26-5"><a></a></span>
<span id="cb26-6"><a></a><span class="kw">function</span> <span class="fu">Integrator</span>(dx<span class="op">::</span><span class="dt">Distribution</span>, n<span class="op">=</span><span class="fl">100</span>)</span>
<span id="cb26-7"><a></a>    x <span class="op">=</span> [<span class="fu">rand</span>(dx) for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n]</span>
<span id="cb26-8"><a></a>    w <span class="op">=</span> <span class="bu">Base</span>.<span class="bu">Iterators</span>.<span class="fu">Repeated</span>(<span class="fl">1</span><span class="op">/</span>n)</span>
<span id="cb26-9"><a></a>    <span class="fu">Integrator</span>(x,w)</span>
<span id="cb26-10"><a></a><span class="kw">end</span></span>
<span id="cb26-11"><a></a></span>
<span id="cb26-12"><a></a>(∫<span class="op">::</span><span class="dt">Integrator</span>)(f) <span class="op">=</span> <span class="fu">sum</span>((xw)<span class="fu">-&gt;f</span>(xw[<span class="fl">1</span>])<span class="op">*</span>xw[<span class="fl">2</span>], <span class="fu">zip</span>(∫.x, ∫.w))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="27fddb0e" class="cell" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a></a><span class="kw">function</span> <span class="fu">share</span>(δ, Σ, x, ∫)</span>
<span id="cb27-2"><a></a>  J,K <span class="op">=</span> <span class="fu">size</span>(x)</span>
<span id="cb27-3"><a></a>  (<span class="fu">length</span>(δ) <span class="op">==</span> J) <span class="op">||</span> <span class="fu">error</span>(<span class="st">"length(δ)=</span><span class="sc">$</span>(<span class="fu">length</span>(δ))<span class="st"> != size(x,1)=</span><span class="sc">$</span>J<span class="st">"</span>)</span>
<span id="cb27-4"><a></a>  (K,K) <span class="op">==</span> <span class="fu">size</span>(Σ) <span class="op">||</span> <span class="fu">error</span>(<span class="st">"size(x,2)=</span><span class="sc">$</span>K<span class="st"> != size(Σ)=</span><span class="sc">$</span>(<span class="fu">size</span>(Σ))<span class="st">"</span>)</span>
<span id="cb27-5"><a></a>  xΣ <span class="op">=</span> x<span class="op">*</span>Σ</span>
<span id="cb27-6"><a></a>  <span class="kw">function</span> <span class="fu">shareν</span>(ν)</span>
<span id="cb27-7"><a></a>    s <span class="op">=</span> δ <span class="op">+</span> xΣ<span class="op">*</span>ν</span>
<span id="cb27-8"><a></a>    smax<span class="op">=</span><span class="fu">max</span>(<span class="fl">0</span>,<span class="fu">maximum</span>(s))</span>
<span id="cb27-9"><a></a>    s <span class="op">=</span> s <span class="op">.-</span> smax</span>
<span id="cb27-10"><a></a>    s <span class="op">=</span> <span class="fu">exp</span>.(s)</span>
<span id="cb27-11"><a></a>    s <span class="op">*=</span> <span class="fl">1</span><span class="op">/</span>(<span class="fu">sum</span>(s) <span class="op">+</span> <span class="fu">exp</span>(<span class="fl">0</span><span class="op">-</span>smax))</span>
<span id="cb27-12"><a></a>    <span class="cf">return</span>(s)</span>
<span id="cb27-13"><a></a>  <span class="kw">end</span></span>
<span id="cb27-14"><a></a>  <span class="cf">return</span>(<span class="fu">∫</span>(shareν))</span>
<span id="cb27-15"><a></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>share (generic function with 1 method)</code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<p>Heap allocated arrays</p>
<div id="06a38ebd" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a></a>J <span class="op">=</span> <span class="fl">10</span></span>
<span id="cb29-2"><a></a>K <span class="op">=</span> <span class="fl">5</span></span>
<span id="cb29-3"><a></a>δ <span class="op">=</span> <span class="fu">rand</span>(J)</span>
<span id="cb29-4"><a></a>X <span class="op">=</span> <span class="fu">randn</span>(J,K)</span>
<span id="cb29-5"><a></a>Σ <span class="op">=</span> I <span class="op">+</span> <span class="fu">zeros</span>(K,K)</span>
<span id="cb29-6"><a></a>∫ <span class="op">=</span> <span class="fu">Integrator</span>(<span class="fu">MvNormal</span>(<span class="fu">zeros</span>(K),I))</span>
<span id="cb29-7"><a></a></span>
<span id="cb29-8"><a></a><span class="pp">@benchmark</span> <span class="fu">share</span>(δ,Σ,X,∫)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">52.217 μs</span> … <span class="ansi-magenta-fg">  5.878 ms</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span> 0.00% … 97.54%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">72.432 μs               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span> 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">93.227 μs</span> ± <span class="ansi-green-fg">242.590 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>11.79% ±  4.47%
          ▁▅██▄▄<span class="ansi-blue-fg"> </span>              <span class="ansi-green-fg"> </span>                                
  ▁▂▂▃▃▃▃▅██████<span class="ansi-blue-fg">█</span>▆▅▅▄▃▃▃▂▂▂▂▂▂▂<span class="ansi-green-fg">▂</span>▂▃▄▅▄▆▅▅▅▄▄▃▄▃▃▃▂▂▂▂▂▂▁▁▁▁▁▁▁▁ ▃
  52.2 μs<span class="ansi-bright-black-fg">         Histogram: frequency by time</span>          137 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">98.78 KiB</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">700</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Stack allocated arrays</p>
<div id="cd2b663f" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a></a><span class="im">using</span> <span class="bu">StaticArrays</span></span>
<span id="cb30-2"><a></a>sδ <span class="op">=</span> <span class="fu">SVector</span><span class="dt">{J}</span>(δ)</span>
<span id="cb30-3"><a></a>sΣ <span class="op">=</span> <span class="fu">SMatrix</span><span class="dt">{K,K}</span>(Σ)</span>
<span id="cb30-4"><a></a>sX <span class="op">=</span> <span class="fu">SMatrix</span><span class="dt">{J,K}</span>(X)</span>
<span id="cb30-5"><a></a>nd <span class="op">=</span> <span class="fu">length</span>(∫.x)</span>
<span id="cb30-6"><a></a>iw <span class="op">=</span> <span class="fu">SVector</span><span class="dt">{nd}</span>(<span class="fu">fill</span>(<span class="fl">1</span><span class="op">/</span>nd,nd))</span>
<span id="cb30-7"><a></a>ix <span class="op">=</span> [<span class="fu">SVector</span><span class="dt">{K}</span>(x) for x <span class="op">∈</span> ∫.x]</span>
<span id="cb30-8"><a></a>s∫ <span class="op">=</span> <span class="fu">Integrator</span>(ix,iw)</span>
<span id="cb30-9"><a></a></span>
<span id="cb30-10"><a></a><span class="pp">@benchmark</span> <span class="fu">share</span>(sδ,sΣ,sX,s∫)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 1 evaluation.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold"> 9.626 μs</span> … <span class="ansi-magenta-fg">39.948 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold"> 9.782 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">10.163 μs</span> ± <span class="ansi-green-fg"> 1.396 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▆█<span class="ansi-blue-fg">▇</span>▂▁  <span class="ansi-green-fg"> </span>▅▆▃ ▂▄▂  ▃▂   ▂▁   ▂▂                               ▂
  ██<span class="ansi-blue-fg">█</span>███▇<span class="ansi-green-fg">▄</span>███▇███▆▅██▇▅███▅▁▆██▇▅▃▃▁▁▁▁▁▄▇▅▄▁▃▃▃▁▁▁▁▃▁▁▃▅▃▁▁▃ █
  9.63 μs<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      14.2 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">96 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">1</span>.</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="memory-considerations" class="slide level2">
<h2>Memory Considerations</h2>
<div>
<ul>
<li class="fragment">Computations are faster when operating accessing contiguous chunks of memory
<ul>
<li class="fragment">Access arrays by columns</li>
</ul></li>
<li class="fragment">Data moves <code>RAM ⇒ Cache ⇒ CPU Registers</code>
<ul>
<li class="fragment"><code>RAM ⇒ Cache</code> much slower than <code>Cache ⇒ CPU Registers</code></li>
<li class="fragment">Can see big benefits from small code that fits on cache</li>
<li class="fragment">CPU prefetches data from <code>RAM ⇒ Cache</code>, by predicting what will be needed</li>
<li class="fragment">Needed data not on <code>Cache</code> when needed is a “cache miss”, these are costly</li>
<li class="fragment">Predictable code without branches and accessing contiguous memory helps avoid caches misses</li>
</ul></li>
</ul>
</div>
</section>
<section id="single-instruction-multiple-data" class="slide level2">
<h2>Single Instruction, Multiple Data</h2>
<ul>
<li>CPUs can perform the same operation on multiple numbers at the same time
<ul>
<li>“Vectorized instructions”</li>
<li>Current generation x86 CPUs have 512 bit registers, can operate on 8 <code>Float64</code> values at once</li>
</ul></li>
<li>Compiler tries to use vectorized instructions when possible
<ul>
<li>Loop of fixed length (no <code>break</code> or <code>continue</code>)</li>
<li>No branching</li>
<li>Re-ordering allowed (indicate with <code>@simd</code>)</li>
</ul></li>
</ul>
</section>
<section id="sisd" class="slide level2">
<h2>SISD</h2>
<div id="da18fdda" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a></a><span class="kw">function</span> <span class="fu">slowdot</span>(a,b)</span>
<span id="cb31-2"><a></a>  out <span class="op">=</span> <span class="fu">one</span>(<span class="fu">promote_type</span>(<span class="fu">eltype</span>(a),<span class="fu">eltype</span>(b)))</span>
<span id="cb31-3"><a></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(a)</span>
<span id="cb31-4"><a></a>    out <span class="op">+=</span> a[i]<span class="op">*</span>b[i]</span>
<span id="cb31-5"><a></a>  <span class="cf">end</span></span>
<span id="cb31-6"><a></a>  out</span>
<span id="cb31-7"><a></a><span class="kw">end</span></span>
<span id="cb31-8"><a></a></span>
<span id="cb31-9"><a></a>n <span class="op">=</span> <span class="fl">1_000</span></span>
<span id="cb31-10"><a></a>a <span class="op">=</span> <span class="fu">rand</span>(n)</span>
<span id="cb31-11"><a></a>b <span class="op">=</span> <span class="fu">rand</span>(n)</span>
<span id="cb31-12"><a></a><span class="pp">@code_llvm</span> <span class="fu">slowdot</span>(a,b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[24]:1 within `slowdot`
define double @julia_slowdot_4839({}* noundef nonnull align 16 dereferenceable(40) %0, {}* noundef nonnull align 16 dereferenceable(40) %1) #0 {
top:
;  @ In[24]:3 within `slowdot`
; ┌ @ abstractarray.jl:321 within `eachindex`
; │┌ @ abstractarray.jl:137 within `axes1`
; ││┌ @ abstractarray.jl:98 within `axes`
; │││┌ @ array.jl:191 within `size`
      %2 = bitcast {}* %0 to { i8*, i64, i16, i16, i32 }*
      %arraylen_ptr = getelementptr inbounds { i8*, i64, i16, i16, i32 }, { i8*, i64, i16, i16, i32 }* %2, i64 0, i32 1
      %arraylen = load i64, i64* %arraylen_ptr, align 8
; └└└└
; ┌ @ range.jl:897 within `iterate`
; │┌ @ range.jl:672 within `isempty`
; ││┌ @ operators.jl:378 within `&gt;`
; │││┌ @ int.jl:83 within `&lt;`
      %.not.not = icmp eq i64 %arraylen, 0
; └└└└
  br i1 %.not.not, label %L31, label %L13.preheader

L13.preheader:                                    ; preds = %top
  %3 = bitcast {}* %1 to { i8*, i64, i16, i16, i32 }*
  %arraylen_ptr8 = getelementptr inbounds { i8*, i64, i16, i16, i32 }, { i8*, i64, i16, i16, i32 }* %3, i64 0, i32 1
  %arraylen9 = load i64, i64* %arraylen_ptr8, align 8
  %4 = bitcast {}* %0 to double**
  %arrayptr23 = load double*, double** %4, align 8
  %5 = bitcast {}* %1 to double**
  %arrayptr1524 = load double*, double** %5, align 8
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %smin = call i64 @llvm.smin.i64(i64 %arraylen9, i64 0)
   %6 = sub i64 %arraylen9, %smin
   %smax = call i64 @llvm.smax.i64(i64 %smin, i64 -1)
   %7 = add nsw i64 %smax, 1
   %8 = mul nuw nsw i64 %6, %7
   %exit.mainloop.at = call i64 @llvm.umin.i64(i64 %arraylen, i64 %8)
   %.not = icmp eq i64 %exit.mainloop.at, 0
   br i1 %.not, label %main.pseudo.exit, label %idxend13.preheader

idxend13.preheader:                               ; preds = %L13.preheader
; └
;  @ In[24]:5 within `slowdot`
  %9 = add nsw i64 %exit.mainloop.at, -1
  %xtraiter = and i64 %exit.mainloop.at, 7
  %10 = icmp ult i64 %9, 7
  br i1 %10, label %main.exit.selector.unr-lcssa, label %idxend13.preheader.new

idxend13.preheader.new:                           ; preds = %idxend13.preheader
  %unroll_iter = and i64 %exit.mainloop.at, 9223372036854775800
  br label %idxend13

L31:                                              ; preds = %idxend13.postloop, %main.exit.selector, %top
  %value_phi20 = phi double [ 1.000000e+00, %top ], [ %.lcssa50, %main.exit.selector ], [ %63, %idxend13.postloop ]
  ret double %value_phi20

oob:                                              ; preds = %L13.postloop
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %errorbox = alloca i64, align 8
   store i64 %value_phi3.postloop, i64* %errorbox, align 8
   call void @ijl_bounds_error_ints({}* %0, i64* nonnull %errorbox, i64 1)
   unreachable

oob11:                                            ; preds = %idxend.postloop
   %errorbox12 = alloca i64, align 8
   store i64 %value_phi3.postloop, i64* %errorbox12, align 8
   call void @ijl_bounds_error_ints({}* %1, i64* nonnull %errorbox12, i64 1)
   unreachable

idxend13:                                         ; preds = %idxend13, %idxend13.preheader.new
   %value_phi3 = phi i64 [ 1, %idxend13.preheader.new ], [ %50, %idxend13 ]
   %value_phi5 = phi double [ 1.000000e+00, %idxend13.preheader.new ], [ %49, %idxend13 ]
   %niter = phi i64 [ 0, %idxend13.preheader.new ], [ %niter.next.7, %idxend13 ]
   %11 = add nsw i64 %value_phi3, -1
   %12 = getelementptr inbounds double, double* %arrayptr23, i64 %11
   %arrayref = load double, double* %12, align 8
   %13 = getelementptr inbounds double, double* %arrayptr1524, i64 %11
   %arrayref16 = load double, double* %13, align 8
; └
; ┌ @ float.jl:411 within `*`
   %14 = fmul double %arrayref, %arrayref16
; └
; ┌ @ float.jl:409 within `+`
   %15 = fadd double %value_phi5, %14
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %16 = add nuw nsw i64 %value_phi3, 1
; └
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %17 = getelementptr inbounds double, double* %arrayptr23, i64 %value_phi3
   %arrayref.1 = load double, double* %17, align 8
   %18 = getelementptr inbounds double, double* %arrayptr1524, i64 %value_phi3
   %arrayref16.1 = load double, double* %18, align 8
; └
; ┌ @ float.jl:411 within `*`
   %19 = fmul double %arrayref.1, %arrayref16.1
; └
; ┌ @ float.jl:409 within `+`
   %20 = fadd double %15, %19
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %21 = add nuw nsw i64 %value_phi3, 2
; └
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %22 = getelementptr inbounds double, double* %arrayptr23, i64 %16
   %arrayref.2 = load double, double* %22, align 8
   %23 = getelementptr inbounds double, double* %arrayptr1524, i64 %16
   %arrayref16.2 = load double, double* %23, align 8
; └
; ┌ @ float.jl:411 within `*`
   %24 = fmul double %arrayref.2, %arrayref16.2
; └
; ┌ @ float.jl:409 within `+`
   %25 = fadd double %20, %24
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %26 = add nuw nsw i64 %value_phi3, 3
; └
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %27 = getelementptr inbounds double, double* %arrayptr23, i64 %21
   %arrayref.3 = load double, double* %27, align 8
   %28 = getelementptr inbounds double, double* %arrayptr1524, i64 %21
   %arrayref16.3 = load double, double* %28, align 8
; └
; ┌ @ float.jl:411 within `*`
   %29 = fmul double %arrayref.3, %arrayref16.3
; └
; ┌ @ float.jl:409 within `+`
   %30 = fadd double %25, %29
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %31 = add nuw nsw i64 %value_phi3, 4
; └
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %32 = getelementptr inbounds double, double* %arrayptr23, i64 %26
   %arrayref.4 = load double, double* %32, align 8
   %33 = getelementptr inbounds double, double* %arrayptr1524, i64 %26
   %arrayref16.4 = load double, double* %33, align 8
; └
; ┌ @ float.jl:411 within `*`
   %34 = fmul double %arrayref.4, %arrayref16.4
; └
; ┌ @ float.jl:409 within `+`
   %35 = fadd double %30, %34
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %36 = add nuw nsw i64 %value_phi3, 5
; └
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %37 = getelementptr inbounds double, double* %arrayptr23, i64 %31
   %arrayref.5 = load double, double* %37, align 8
   %38 = getelementptr inbounds double, double* %arrayptr1524, i64 %31
   %arrayref16.5 = load double, double* %38, align 8
; └
; ┌ @ float.jl:411 within `*`
   %39 = fmul double %arrayref.5, %arrayref16.5
; └
; ┌ @ float.jl:409 within `+`
   %40 = fadd double %35, %39
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %41 = add nuw nsw i64 %value_phi3, 6
; └
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %42 = getelementptr inbounds double, double* %arrayptr23, i64 %36
   %arrayref.6 = load double, double* %42, align 8
   %43 = getelementptr inbounds double, double* %arrayptr1524, i64 %36
   %arrayref16.6 = load double, double* %43, align 8
; └
; ┌ @ float.jl:411 within `*`
   %44 = fmul double %arrayref.6, %arrayref16.6
; └
; ┌ @ float.jl:409 within `+`
   %45 = fadd double %40, %44
; └
; ┌ @ essentials.jl:13 within `getindex`
   %46 = getelementptr inbounds double, double* %arrayptr23, i64 %41
   %arrayref.7 = load double, double* %46, align 8
   %47 = getelementptr inbounds double, double* %arrayptr1524, i64 %41
   %arrayref16.7 = load double, double* %47, align 8
; └
; ┌ @ float.jl:411 within `*`
   %48 = fmul double %arrayref.7, %arrayref16.7
; └
; ┌ @ float.jl:409 within `+`
   %49 = fadd double %45, %48
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %50 = add nuw nsw i64 %value_phi3, 8
; └
  %niter.next.7 = add nuw i64 %niter, 8
  %niter.ncmp.7.not = icmp eq i64 %niter.next.7, %unroll_iter
  br i1 %niter.ncmp.7.not, label %main.exit.selector.unr-lcssa.loopexit, label %idxend13

main.exit.selector.unr-lcssa.loopexit:            ; preds = %idxend13
; ┌ @ range.jl:901 within `iterate`
   %51 = add nuw nsw i64 %value_phi3, 7
; └
  br label %main.exit.selector.unr-lcssa

main.exit.selector.unr-lcssa:                     ; preds = %main.exit.selector.unr-lcssa.loopexit, %idxend13.preheader
  %value_phi3.lcssa.ph = phi i64 [ undef, %idxend13.preheader ], [ %51, %main.exit.selector.unr-lcssa.loopexit ]
  %.lcssa50.ph = phi double [ undef, %idxend13.preheader ], [ %49, %main.exit.selector.unr-lcssa.loopexit ]
  %.lcssa49.ph = phi i64 [ undef, %idxend13.preheader ], [ %50, %main.exit.selector.unr-lcssa.loopexit ]
  %value_phi3.unr = phi i64 [ 1, %idxend13.preheader ], [ %50, %main.exit.selector.unr-lcssa.loopexit ]
  %value_phi5.unr = phi double [ 1.000000e+00, %idxend13.preheader ], [ %49, %main.exit.selector.unr-lcssa.loopexit ]
  %lcmp.mod.not = icmp eq i64 %xtraiter, 0
  br i1 %lcmp.mod.not, label %main.exit.selector, label %idxend13.epil

idxend13.epil:                                    ; preds = %idxend13.epil, %main.exit.selector.unr-lcssa
  %value_phi3.epil = phi i64 [ %57, %idxend13.epil ], [ %value_phi3.unr, %main.exit.selector.unr-lcssa ]
  %value_phi5.epil = phi double [ %56, %idxend13.epil ], [ %value_phi5.unr, %main.exit.selector.unr-lcssa ]
  %epil.iter = phi i64 [ %epil.iter.next, %idxend13.epil ], [ 0, %main.exit.selector.unr-lcssa ]
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %52 = add nsw i64 %value_phi3.epil, -1
   %53 = getelementptr inbounds double, double* %arrayptr23, i64 %52
   %arrayref.epil = load double, double* %53, align 8
   %54 = getelementptr inbounds double, double* %arrayptr1524, i64 %52
   %arrayref16.epil = load double, double* %54, align 8
; └
; ┌ @ float.jl:411 within `*`
   %55 = fmul double %arrayref.epil, %arrayref16.epil
; └
; ┌ @ float.jl:409 within `+`
   %56 = fadd double %value_phi5.epil, %55
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %57 = add nuw nsw i64 %value_phi3.epil, 1
; └
  %epil.iter.next = add i64 %epil.iter, 1
  %epil.iter.cmp.not = icmp eq i64 %epil.iter.next, %xtraiter
  br i1 %epil.iter.cmp.not, label %main.exit.selector, label %idxend13.epil

main.exit.selector:                               ; preds = %idxend13.epil, %main.exit.selector.unr-lcssa
  %value_phi3.lcssa = phi i64 [ %value_phi3.lcssa.ph, %main.exit.selector.unr-lcssa ], [ %value_phi3.epil, %idxend13.epil ]
;  @ In[24]:4 within `slowdot`
; ┌ @ float.jl:409 within `+`
   %.lcssa50 = phi double [ %.lcssa50.ph, %main.exit.selector.unr-lcssa ], [ %56, %idxend13.epil ]
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
   %.lcssa49 = phi i64 [ %.lcssa49.ph, %main.exit.selector.unr-lcssa ], [ %57, %idxend13.epil ]
; └
  %58 = icmp ult i64 %value_phi3.lcssa, %arraylen
  br i1 %58, label %main.pseudo.exit, label %L31

main.pseudo.exit:                                 ; preds = %main.exit.selector, %L13.preheader
  %value_phi3.copy = phi i64 [ 1, %L13.preheader ], [ %.lcssa49, %main.exit.selector ]
  %value_phi5.copy = phi double [ 1.000000e+00, %L13.preheader ], [ %.lcssa50, %main.exit.selector ]
  br label %L13.postloop

L13.postloop:                                     ; preds = %idxend13.postloop, %main.pseudo.exit
  %value_phi3.postloop = phi i64 [ %64, %idxend13.postloop ], [ %value_phi3.copy, %main.pseudo.exit ]
  %value_phi5.postloop = phi double [ %63, %idxend13.postloop ], [ %value_phi5.copy, %main.pseudo.exit ]
;  @ In[24]:4 within `slowdot`
; ┌ @ essentials.jl:13 within `getindex`
   %59 = add i64 %value_phi3.postloop, -1
   %inbounds.postloop = icmp ult i64 %59, %arraylen
   br i1 %inbounds.postloop, label %idxend.postloop, label %oob

idxend.postloop:                                  ; preds = %L13.postloop
   %inbounds10.postloop = icmp ult i64 %59, %arraylen9
   br i1 %inbounds10.postloop, label %idxend13.postloop, label %oob11

idxend13.postloop:                                ; preds = %idxend.postloop
   %60 = getelementptr inbounds double, double* %arrayptr23, i64 %59
   %arrayref.postloop = load double, double* %60, align 8
   %61 = getelementptr inbounds double, double* %arrayptr1524, i64 %59
   %arrayref16.postloop = load double, double* %61, align 8
; └
; ┌ @ float.jl:411 within `*`
   %62 = fmul double %arrayref.postloop, %arrayref16.postloop
; └
; ┌ @ float.jl:409 within `+`
   %63 = fadd double %value_phi5.postloop, %62
; └
;  @ In[24]:5 within `slowdot`
; ┌ @ range.jl:901 within `iterate`
; │┌ @ promotion.jl:521 within `==`
    %.not.not25.postloop = icmp eq i64 %value_phi3.postloop, %arraylen
; │└
   %64 = add nuw nsw i64 %value_phi3.postloop, 1
; └
  br i1 %.not.not25.postloop, label %L31, label %L13.postloop
}</code></pre>
</div>
</div>
</section>
<section id="simd" class="slide level2">
<h2>SIMD</h2>
<div id="9fe6a9c0" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a></a><span class="kw">function</span> <span class="fu">fastdot</span>(a,b)</span>
<span id="cb33-2"><a></a>  out <span class="op">=</span> <span class="fu">one</span>(<span class="fu">promote_type</span>(<span class="fu">eltype</span>(a),<span class="fu">eltype</span>(b)))</span>
<span id="cb33-3"><a></a>  <span class="pp">@simd</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(a)</span>
<span id="cb33-4"><a></a>    out <span class="op">+=</span> a[i]<span class="op">*</span>b[i]</span>
<span id="cb33-5"><a></a>  <span class="cf">end</span></span>
<span id="cb33-6"><a></a>  out</span>
<span id="cb33-7"><a></a><span class="kw">end</span></span>
<span id="cb33-8"><a></a></span>
<span id="cb33-9"><a></a><span class="pp">@code_llvm</span> <span class="fu">fastdot</span>(a,b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[25]:1 within `fastdot`
define double @julia_fastdot_4863({}* noundef nonnull align 16 dereferenceable(40) %0, {}* noundef nonnull align 16 dereferenceable(40) %1) #0 {
top:
;  @ In[25]:3 within `fastdot`
; ┌ @ simdloop.jl:69 within `macro expansion`
; │┌ @ abstractarray.jl:321 within `eachindex`
; ││┌ @ abstractarray.jl:137 within `axes1`
; │││┌ @ abstractarray.jl:98 within `axes`
; ││││┌ @ array.jl:191 within `size`
       %2 = bitcast {}* %0 to { i8*, i64, i16, i16, i32 }*
       %arraylen_ptr = getelementptr inbounds { i8*, i64, i16, i16, i32 }, { i8*, i64, i16, i16, i32 }* %2, i64 0, i32 1
       %arraylen = load i64, i64* %arraylen_ptr, align 8
; │└└└└
; │ @ simdloop.jl:72 within `macro expansion`
; │┌ @ int.jl:83 within `&lt;`
    %.not = icmp eq i64 %arraylen, 0
; │└
   br i1 %.not, label %L32, label %L13.lr.ph

L13.lr.ph:                                        ; preds = %top
   %3 = bitcast {}* %1 to { i8*, i64, i16, i16, i32 }*
   %arraylen_ptr4 = getelementptr inbounds { i8*, i64, i16, i16, i32 }, { i8*, i64, i16, i16, i32 }* %3, i64 0, i32 1
   %arraylen5 = load i64, i64* %arraylen_ptr4, align 8
   %4 = bitcast {}* %0 to double**
   %arrayptr17 = load double*, double** %4, align 8
   %5 = bitcast {}* %1 to double**
   %arrayptr1118 = load double*, double** %5, align 8
; │ @ simdloop.jl:75 within `macro expansion`
   %6 = add i64 %arraylen5, -9223372036854775807
   %smax = call i64 @llvm.smax.i64(i64 %6, i64 0)
   %7 = sub i64 %arraylen5, %smax
   %arraylen5.lobit = ashr i64 %arraylen5, 63
   %8 = add nsw i64 %arraylen5.lobit, 1
   %9 = mul nuw nsw i64 %7, %8
   %smin27 = call i64 @llvm.smin.i64(i64 %arraylen, i64 %9)
   %exit.mainloop.at = call i64 @llvm.smax.i64(i64 %smin27, i64 0)
   %.not39 = icmp slt i64 %smin27, 1
   br i1 %.not39, label %main.pseudo.exit, label %idxend9.preheader

idxend9.preheader:                                ; preds = %L13.lr.ph
   %min.iters.check = icmp ult i64 %exit.mainloop.at, 16
   br i1 %min.iters.check, label %scalar.ph, label %vector.ph

vector.ph:                                        ; preds = %idxend9.preheader
   %n.vec = and i64 %exit.mainloop.at, 9223372036854775792
   %10 = add nsw i64 %n.vec, -16
   %11 = lshr exact i64 %10, 4
   %12 = add nuw nsw i64 %11, 1
   %xtraiter = and i64 %12, 1
   %13 = icmp eq i64 %10, 0
   br i1 %13, label %middle.block.unr-lcssa, label %vector.ph.new

vector.ph.new:                                    ; preds = %vector.ph
   %unroll_iter = and i64 %12, 2305843009213693950
   br label %vector.body

vector.body:                                      ; preds = %vector.body, %vector.ph.new
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ int.jl:87 within `+`
     %index = phi i64 [ 0, %vector.ph.new ], [ %index.next.1, %vector.body ]
     %vec.phi = phi &lt;4 x double&gt; [ &lt;double 1.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph.new ], [ %58, %vector.body ]
     %vec.phi44 = phi &lt;4 x double&gt; [ &lt;double -0.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph.new ], [ %59, %vector.body ]
     %vec.phi45 = phi &lt;4 x double&gt; [ &lt;double -0.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph.new ], [ %60, %vector.body ]
     %vec.phi46 = phi &lt;4 x double&gt; [ &lt;double -0.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph.new ], [ %61, %vector.body ]
     %niter = phi i64 [ 0, %vector.ph.new ], [ %niter.next.1, %vector.body ]
; │└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ essentials.jl:13 within `getindex`
    %14 = getelementptr inbounds double, double* %arrayptr17, i64 %index
    %15 = bitcast double* %14 to &lt;4 x double&gt;*
    %wide.load = load &lt;4 x double&gt;, &lt;4 x double&gt;* %15, align 8
    %16 = getelementptr inbounds double, double* %14, i64 4
    %17 = bitcast double* %16 to &lt;4 x double&gt;*
    %wide.load47 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %17, align 8
    %18 = getelementptr inbounds double, double* %14, i64 8
    %19 = bitcast double* %18 to &lt;4 x double&gt;*
    %wide.load48 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %19, align 8
    %20 = getelementptr inbounds double, double* %14, i64 12
    %21 = bitcast double* %20 to &lt;4 x double&gt;*
    %wide.load49 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %21, align 8
    %22 = getelementptr inbounds double, double* %arrayptr1118, i64 %index
    %23 = bitcast double* %22 to &lt;4 x double&gt;*
    %wide.load50 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %23, align 8
    %24 = getelementptr inbounds double, double* %22, i64 4
    %25 = bitcast double* %24 to &lt;4 x double&gt;*
    %wide.load51 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %25, align 8
    %26 = getelementptr inbounds double, double* %22, i64 8
    %27 = bitcast double* %26 to &lt;4 x double&gt;*
    %wide.load52 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %27, align 8
    %28 = getelementptr inbounds double, double* %22, i64 12
    %29 = bitcast double* %28 to &lt;4 x double&gt;*
    %wide.load53 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %29, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %30 = fmul contract &lt;4 x double&gt; %wide.load, %wide.load50
    %31 = fmul contract &lt;4 x double&gt; %wide.load47, %wide.load51
    %32 = fmul contract &lt;4 x double&gt; %wide.load48, %wide.load52
    %33 = fmul contract &lt;4 x double&gt; %wide.load49, %wide.load53
; │└
; │┌ @ float.jl:409 within `+`
    %34 = fadd reassoc contract &lt;4 x double&gt; %vec.phi, %30
    %35 = fadd reassoc contract &lt;4 x double&gt; %vec.phi44, %31
    %36 = fadd reassoc contract &lt;4 x double&gt; %vec.phi45, %32
    %37 = fadd reassoc contract &lt;4 x double&gt; %vec.phi46, %33
; │└
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ int.jl:87 within `+`
     %index.next = or i64 %index, 16
; │└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ essentials.jl:13 within `getindex`
    %38 = getelementptr inbounds double, double* %arrayptr17, i64 %index.next
    %39 = bitcast double* %38 to &lt;4 x double&gt;*
    %wide.load.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %39, align 8
    %40 = getelementptr inbounds double, double* %38, i64 4
    %41 = bitcast double* %40 to &lt;4 x double&gt;*
    %wide.load47.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %41, align 8
    %42 = getelementptr inbounds double, double* %38, i64 8
    %43 = bitcast double* %42 to &lt;4 x double&gt;*
    %wide.load48.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %43, align 8
    %44 = getelementptr inbounds double, double* %38, i64 12
    %45 = bitcast double* %44 to &lt;4 x double&gt;*
    %wide.load49.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %45, align 8
    %46 = getelementptr inbounds double, double* %arrayptr1118, i64 %index.next
    %47 = bitcast double* %46 to &lt;4 x double&gt;*
    %wide.load50.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %47, align 8
    %48 = getelementptr inbounds double, double* %46, i64 4
    %49 = bitcast double* %48 to &lt;4 x double&gt;*
    %wide.load51.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %49, align 8
    %50 = getelementptr inbounds double, double* %46, i64 8
    %51 = bitcast double* %50 to &lt;4 x double&gt;*
    %wide.load52.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %51, align 8
    %52 = getelementptr inbounds double, double* %46, i64 12
    %53 = bitcast double* %52 to &lt;4 x double&gt;*
    %wide.load53.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %53, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %54 = fmul contract &lt;4 x double&gt; %wide.load.1, %wide.load50.1
    %55 = fmul contract &lt;4 x double&gt; %wide.load47.1, %wide.load51.1
    %56 = fmul contract &lt;4 x double&gt; %wide.load48.1, %wide.load52.1
    %57 = fmul contract &lt;4 x double&gt; %wide.load49.1, %wide.load53.1
; │└
; │┌ @ float.jl:409 within `+`
    %58 = fadd reassoc contract &lt;4 x double&gt; %34, %54
    %59 = fadd reassoc contract &lt;4 x double&gt; %35, %55
    %60 = fadd reassoc contract &lt;4 x double&gt; %36, %56
    %61 = fadd reassoc contract &lt;4 x double&gt; %37, %57
; │└
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ int.jl:87 within `+`
     %index.next.1 = add nuw i64 %index, 32
     %niter.next.1 = add i64 %niter, 2
     %niter.ncmp.1 = icmp eq i64 %niter.next.1, %unroll_iter
     br i1 %niter.ncmp.1, label %middle.block.unr-lcssa, label %vector.body

middle.block.unr-lcssa:                           ; preds = %vector.body, %vector.ph
     %.lcssa63.ph = phi &lt;4 x double&gt; [ undef, %vector.ph ], [ %58, %vector.body ]
     %.lcssa62.ph = phi &lt;4 x double&gt; [ undef, %vector.ph ], [ %59, %vector.body ]
     %.lcssa61.ph = phi &lt;4 x double&gt; [ undef, %vector.ph ], [ %60, %vector.body ]
     %.lcssa60.ph = phi &lt;4 x double&gt; [ undef, %vector.ph ], [ %61, %vector.body ]
     %index.unr = phi i64 [ 0, %vector.ph ], [ %index.next.1, %vector.body ]
     %vec.phi.unr = phi &lt;4 x double&gt; [ &lt;double 1.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph ], [ %58, %vector.body ]
     %vec.phi44.unr = phi &lt;4 x double&gt; [ &lt;double -0.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph ], [ %59, %vector.body ]
     %vec.phi45.unr = phi &lt;4 x double&gt; [ &lt;double -0.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph ], [ %60, %vector.body ]
     %vec.phi46.unr = phi &lt;4 x double&gt; [ &lt;double -0.000000e+00, double -0.000000e+00, double -0.000000e+00, double -0.000000e+00&gt;, %vector.ph ], [ %61, %vector.body ]
     %lcmp.mod.not = icmp eq i64 %xtraiter, 0
     br i1 %lcmp.mod.not, label %middle.block, label %vector.body.epil.preheader

vector.body.epil.preheader:                       ; preds = %middle.block.unr-lcssa
; │└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ essentials.jl:13 within `getindex`
    %62 = getelementptr inbounds double, double* %arrayptr17, i64 %index.unr
    %63 = bitcast double* %62 to &lt;4 x double&gt;*
    %wide.load.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %63, align 8
    %64 = getelementptr inbounds double, double* %62, i64 4
    %65 = bitcast double* %64 to &lt;4 x double&gt;*
    %wide.load47.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %65, align 8
    %66 = getelementptr inbounds double, double* %62, i64 8
    %67 = bitcast double* %66 to &lt;4 x double&gt;*
    %wide.load48.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %67, align 8
    %68 = getelementptr inbounds double, double* %62, i64 12
    %69 = bitcast double* %68 to &lt;4 x double&gt;*
    %wide.load49.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %69, align 8
    %70 = getelementptr inbounds double, double* %arrayptr1118, i64 %index.unr
    %71 = bitcast double* %70 to &lt;4 x double&gt;*
    %wide.load50.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %71, align 8
    %72 = getelementptr inbounds double, double* %70, i64 4
    %73 = bitcast double* %72 to &lt;4 x double&gt;*
    %wide.load51.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %73, align 8
    %74 = getelementptr inbounds double, double* %70, i64 8
    %75 = bitcast double* %74 to &lt;4 x double&gt;*
    %wide.load52.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %75, align 8
    %76 = getelementptr inbounds double, double* %70, i64 12
    %77 = bitcast double* %76 to &lt;4 x double&gt;*
    %wide.load53.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %77, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %78 = fmul contract &lt;4 x double&gt; %wide.load.epil, %wide.load50.epil
    %79 = fmul contract &lt;4 x double&gt; %wide.load47.epil, %wide.load51.epil
    %80 = fmul contract &lt;4 x double&gt; %wide.load48.epil, %wide.load52.epil
    %81 = fmul contract &lt;4 x double&gt; %wide.load49.epil, %wide.load53.epil
; │└
; │┌ @ float.jl:409 within `+`
    %82 = fadd reassoc contract &lt;4 x double&gt; %vec.phi.unr, %78
    %83 = fadd reassoc contract &lt;4 x double&gt; %vec.phi44.unr, %79
    %84 = fadd reassoc contract &lt;4 x double&gt; %vec.phi45.unr, %80
    %85 = fadd reassoc contract &lt;4 x double&gt; %vec.phi46.unr, %81
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   br label %middle.block

middle.block:                                     ; preds = %vector.body.epil.preheader, %middle.block.unr-lcssa
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ float.jl:409 within `+`
    %.lcssa63 = phi &lt;4 x double&gt; [ %.lcssa63.ph, %middle.block.unr-lcssa ], [ %82, %vector.body.epil.preheader ]
    %.lcssa62 = phi &lt;4 x double&gt; [ %.lcssa62.ph, %middle.block.unr-lcssa ], [ %83, %vector.body.epil.preheader ]
    %.lcssa61 = phi &lt;4 x double&gt; [ %.lcssa61.ph, %middle.block.unr-lcssa ], [ %84, %vector.body.epil.preheader ]
    %.lcssa60 = phi &lt;4 x double&gt; [ %.lcssa60.ph, %middle.block.unr-lcssa ], [ %85, %vector.body.epil.preheader ]
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %bin.rdx = fadd reassoc contract &lt;4 x double&gt; %.lcssa62, %.lcssa63
   %bin.rdx54 = fadd reassoc contract &lt;4 x double&gt; %.lcssa61, %bin.rdx
   %bin.rdx55 = fadd reassoc contract &lt;4 x double&gt; %.lcssa60, %bin.rdx54
   %86 = call reassoc contract double @llvm.vector.reduce.fadd.v4f64(double -0.000000e+00, &lt;4 x double&gt; %bin.rdx55)
   %cmp.n = icmp eq i64 %exit.mainloop.at, %n.vec
   br i1 %cmp.n, label %main.exit.selector, label %scalar.ph

scalar.ph:                                        ; preds = %middle.block, %idxend9.preheader
   %bc.resume.val = phi i64 [ %n.vec, %middle.block ], [ 0, %idxend9.preheader ]
   %bc.merge.rdx = phi double [ %86, %middle.block ], [ 1.000000e+00, %idxend9.preheader ]
   br label %idxend9

L32:                                              ; preds = %idxend9.postloop, %main.exit.selector, %top
   %value_phi13 = phi double [ 1.000000e+00, %top ], [ %.lcssa43, %main.exit.selector ], [ %97, %idxend9.postloop ]
; │ @ simdloop.jl:86 within `macro expansion`
   ret double %value_phi13

oob:                                              ; preds = %L13.postloop
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ essentials.jl:13 within `getindex`
    %errorbox = alloca i64, align 8
    store i64 %93, i64* %errorbox, align 8
    call void @ijl_bounds_error_ints({}* %0, i64* nonnull %errorbox, i64 1)
    unreachable

oob7:                                             ; preds = %idxend.postloop
    %errorbox8 = alloca i64, align 8
    store i64 %93, i64* %errorbox8, align 8
    call void @ijl_bounds_error_ints({}* %1, i64* nonnull %errorbox8, i64 1)
    unreachable

idxend9:                                          ; preds = %idxend9, %scalar.ph
    %value_phi124 = phi i64 [ %87, %idxend9 ], [ %bc.resume.val, %scalar.ph ]
    %value_phi23 = phi double [ %91, %idxend9 ], [ %bc.merge.rdx, %scalar.ph ]
; │└
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ int.jl:87 within `+`
     %87 = add nuw nsw i64 %value_phi124, 1
; │└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ essentials.jl:13 within `getindex`
    %88 = getelementptr inbounds double, double* %arrayptr17, i64 %value_phi124
    %arrayref = load double, double* %88, align 8
    %89 = getelementptr inbounds double, double* %arrayptr1118, i64 %value_phi124
    %arrayref12 = load double, double* %89, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %90 = fmul contract double %arrayref, %arrayref12
; │└
; │┌ @ float.jl:409 within `+`
    %91 = fadd reassoc contract double %value_phi23, %90
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %exitcond.not = icmp eq i64 %87, %exit.mainloop.at
   br i1 %exitcond.not, label %main.exit.selector, label %idxend9

main.exit.selector:                               ; preds = %idxend9, %middle.block
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ float.jl:409 within `+`
    %.lcssa43 = phi double [ %86, %middle.block ], [ %91, %idxend9 ]
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %92 = icmp ult i64 %exit.mainloop.at, %arraylen
   br i1 %92, label %main.pseudo.exit, label %L32

main.pseudo.exit:                                 ; preds = %main.exit.selector, %L13.lr.ph
   %value_phi23.copy = phi double [ 1.000000e+00, %L13.lr.ph ], [ %.lcssa43, %main.exit.selector ]
   br label %L13.postloop

L13.postloop:                                     ; preds = %idxend9.postloop, %main.pseudo.exit
   %value_phi124.postloop = phi i64 [ %exit.mainloop.at, %main.pseudo.exit ], [ %93, %idxend9.postloop ]
   %value_phi23.postloop = phi double [ %value_phi23.copy, %main.pseudo.exit ], [ %97, %idxend9.postloop ]
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ int.jl:87 within `+`
     %93 = add nuw nsw i64 %value_phi124.postloop, 1
; │└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[25]:4
; │┌ @ essentials.jl:13 within `getindex`
    %inbounds.postloop = icmp ult i64 %value_phi124.postloop, %arraylen
    br i1 %inbounds.postloop, label %idxend.postloop, label %oob

idxend.postloop:                                  ; preds = %L13.postloop
    %inbounds6.postloop = icmp ult i64 %value_phi124.postloop, %arraylen5
    br i1 %inbounds6.postloop, label %idxend9.postloop, label %oob7

idxend9.postloop:                                 ; preds = %idxend.postloop
    %94 = getelementptr inbounds double, double* %arrayptr17, i64 %value_phi124.postloop
    %arrayref.postloop = load double, double* %94, align 8
    %95 = getelementptr inbounds double, double* %arrayptr1118, i64 %value_phi124.postloop
    %arrayref12.postloop = load double, double* %95, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %96 = fmul contract double %arrayref.postloop, %arrayref12.postloop
; │└
; │┌ @ float.jl:409 within `+`
    %97 = fadd reassoc contract double %value_phi23.postloop, %96
; │└
; │ @ simdloop.jl:75 within `macro expansion`
; │┌ @ int.jl:83 within `&lt;`
    %.not16.postloop = icmp ult i64 %93, %arraylen
; │└
   br i1 %.not16.postloop, label %L13.postloop, label %L32
; └
}</code></pre>
</div>
</div>
</section>
<section id="multiple-faster-than-single" class="slide level2">
<h2>Multiple faster than Single</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div id="b0748b25" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a></a><span class="pp">@benchmark</span> <span class="fu">slowdot</span>(<span class="op">$</span>a,<span class="op">$</span>b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 53 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">878.717 ns</span> … <span class="ansi-magenta-fg"> 1.780 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">879.717 ns              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">896.760 ns</span> ± <span class="ansi-green-fg">55.937 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  <span class="ansi-blue-fg">█</span>  <span class="ansi-green-fg"> </span>     ▂▅    ▂                                             ▁
  <span class="ansi-blue-fg">█</span>▃▄<span class="ansi-green-fg">▄</span>▁▃▁▁▁██▆▆▆▆█▆▅▁▄▁▆▁▁▄▅▅▆▄▃▃▄▃▁▆▁▁▁▁▁▁▁▁▁▁▁▁▃▁▄▄▅▅▆▆▆▆▅▆▆ █
  879 ns<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      1.21 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="fcfd5262" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a></a><span class="pp">@benchmark</span> <span class="fu">fastdot</span>(<span class="op">$</span>a,<span class="op">$</span>b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 923 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">113.283 ns</span> … <span class="ansi-magenta-fg"> 3.381 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">113.437 ns              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">115.102 ns</span> ± <span class="ansi-green-fg">32.949 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  <span class="ansi-blue-fg">█</span>    <span class="ansi-green-fg"> </span>             ▄          ▂                              ▁
  <span class="ansi-blue-fg">█</span>▆▁▁▁<span class="ansi-green-fg">▁</span>▁▁▁▃▇████▇▇▆▄██▄▃▄▁▄▁▄▁▁█▄▄▅▄▄▅▅▅▅▅█▆▁▄▅▆▅▅▆▆▆▅▆▆▄▆▄▅▅ █
  113 ns<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>       135 ns <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="beyond-simd" class="slide level2">
<h2>Beyond <code>@simd</code></h2>
<ul>
<li><code>@simd</code> is somewhat conservative in its vectorization</li>
<li>The <a href="https://github.com/JuliaSIMD/LoopVectorization.jl">LoopVectorization</a> provides a more aggresive auto-vectorization macro, <code>@turbo</code>
<ul>
<li>Unless new maintainer steps forward, will not work with Julia 1.11 and newer</li>
<li>Does not work for all loops</li>
</ul></li>
<li>Can manually write SIMD code
<ul>
<li>Using <a href="https://github.com/eschnett/SIMD.jl">SIMD.jl</a></li>
<li>Using <code>llvmcall</code> (not recommended)</li>
</ul></li>
</ul>
</section>
<section id="simd.jl-example" class="slide level2">
<h2>SIMD.jl Example</h2>
<ul>
<li>Based on https://schrimpf.github.io/ARGridBootstrap.jl/argridboot.html#simd</li>
</ul>
<div id="96440729" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a></a><span class="im">using</span> <span class="bu">LoopVectorization</span>, <span class="bu">SIMD</span></span>
<span id="cb37-2"><a></a></span>
<span id="cb37-3"><a></a>T <span class="op">=</span> <span class="fl">1000</span></span>
<span id="cb37-4"><a></a><span class="cn">e</span> <span class="op">=</span> <span class="fu">zeros</span>(T)</span>
<span id="cb37-5"><a></a>y <span class="op">=</span> <span class="fu">randn</span>(T)</span>
<span id="cb37-6"><a></a>θ <span class="op">=</span> <span class="fu">ones</span>(<span class="fl">3</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<div id="cdbc7105" class="cell" data-execution_count="28">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a></a><span class="kw">function</span> <span class="fu">resids!</span>(<span class="cn">e</span>, yin, θ)</span>
<span id="cb38-2"><a></a>  T <span class="op">=</span> <span class="fu">length</span>(yin)</span>
<span id="cb38-3"><a></a>  <span class="pp">@inbounds</span> <span class="pp">@simd</span> <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>T</span>
<span id="cb38-4"><a></a>    <span class="cn">e</span>[t<span class="op">-</span><span class="fl">1</span>] <span class="op">=</span> yin[t] <span class="op">-</span> θ[<span class="fl">1</span>] <span class="op">-</span> θ[<span class="fl">2</span>]<span class="op">*</span>t <span class="op">-</span> θ[<span class="fl">3</span>]<span class="op">*</span>yin[t<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb38-5"><a></a>  <span class="cf">end</span></span>
<span id="cb38-6"><a></a>  <span class="cn">nothing</span></span>
<span id="cb38-7"><a></a><span class="kw">end</span></span>
<span id="cb38-8"><a></a></span>
<span id="cb38-9"><a></a><span class="pp">@code_llvm</span> <span class="fu">resids!</span>(<span class="cn">e</span>,y, θ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[29]:1 within `resids!`
define nonnull {}* @"japi1_resids!_4964"({}* %function, {}** noalias nocapture noundef readonly %args, i32 %nargs) #0 {
top:
  %stackargs = alloca {}**, align 8
  store volatile {}** %args, {}*** %stackargs, align 8
  %0 = getelementptr inbounds {}*, {}** %args, i64 1
  %1 = load {}*, {}** %0, align 8
;  @ In[29]:2 within `resids!`
; ┌ @ essentials.jl:10 within `length`
   %2 = bitcast {}* %1 to { i8*, i64, i16, i16, i32 }*
   %arraylen_ptr = getelementptr inbounds { i8*, i64, i16, i16, i32 }, { i8*, i64, i16, i16, i32 }* %2, i64 0, i32 1
   %arraylen = load i64, i64* %arraylen_ptr, align 8
; └
;  @ In[29]:3 within `resids!`
; ┌ @ simdloop.jl within `macro expansion`
   %3 = call i64 @llvm.umax.i64(i64 %arraylen, i64 1)
; │ @ simdloop.jl:71 within `macro expansion`
; │┌ @ simdloop.jl:51 within `simd_inner_length`
; ││┌ @ range.jl:761 within `length`
; │││┌ @ int.jl:87 within `+`
      %4 = add nsw i64 %3, -1
; │└└└
; │ @ simdloop.jl:72 within `macro expansion`
; │┌ @ int.jl:83 within `&lt;`
    %5 = icmp ult i64 %arraylen, 2
    %.not23.not = icmp eq i64 %4, 0
; │└
   %or.cond = select i1 %5, i1 true, i1 %.not23.not
   br i1 %or.cond, label %L56, label %L19.lr.ph

L19.lr.ph:                                        ; preds = %top
   %6 = getelementptr inbounds {}*, {}** %args, i64 2
   %7 = bitcast {}** %6 to double***
   %8 = load double**, double*** %7, align 8
   %9 = bitcast {}** %args to double***
   %10 = load double**, double*** %9, align 8
   %11 = bitcast {}* %1 to double**
   %arrayptr17 = load double*, double** %11, align 8
   %arrayptr418 = load double*, double** %8, align 8
   %12 = getelementptr inbounds double, double* %arrayptr418, i64 1
   %13 = getelementptr inbounds double, double* %arrayptr418, i64 2
   %arrayptr1622 = load double*, double** %10, align 8
; │ @ simdloop.jl:75 within `macro expansion`
   %min.iters.check = icmp ult i64 %4, 8
   br i1 %min.iters.check, label %scalar.ph, label %vector.memcheck

vector.memcheck:                                  ; preds = %L19.lr.ph
   %scevgep = getelementptr double, double* %arrayptr1622, i64 %4
   %scevgep28 = getelementptr double, double* %arrayptr17, i64 %3
   %scevgep31 = getelementptr double, double* %arrayptr418, i64 3
   %bound0 = icmp ult double* %arrayptr1622, %scevgep28
   %bound1 = icmp ult double* %arrayptr17, %scevgep
   %found.conflict = and i1 %bound0, %bound1
   %bound033 = icmp ult double* %arrayptr1622, %scevgep31
   %bound134 = icmp ult double* %arrayptr418, %scevgep
   %found.conflict35 = and i1 %bound033, %bound134
   %conflict.rdx = or i1 %found.conflict, %found.conflict35
   br i1 %conflict.rdx, label %scalar.ph, label %vector.ph

vector.ph:                                        ; preds = %vector.memcheck
   %n.vec = and i64 %4, -4
   %14 = add nsw i64 %n.vec, -4
   %15 = lshr exact i64 %14, 2
   %16 = add nuw nsw i64 %15, 1
   %xtraiter = and i64 %16, 1
   %17 = icmp eq i64 %14, 0
   br i1 %17, label %middle.block.unr-lcssa, label %vector.ph.new

vector.ph.new:                                    ; preds = %vector.ph
   %unroll_iter = and i64 %16, 9223372036854775806
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %.pre = load double, double* %arrayptr418, align 8
    %.pre43 = load double, double* %12, align 8
    %.pre44 = load double, double* %13, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   br label %vector.body

vector.body:                                      ; preds = %vector.body, %vector.ph.new
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %index = phi i64 [ 0, %vector.ph.new ], [ %index.next.1, %vector.body ]
    %vec.ind = phi &lt;4 x i64&gt; [ &lt;i64 0, i64 1, i64 2, i64 3&gt;, %vector.ph.new ], [ %vec.ind.next.1, %vector.body ]
    %niter = phi i64 [ 0, %vector.ph.new ], [ %niter.next.1, %vector.body ]
; │└
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ range.jl:929 within `getindex`
; │││┌ @ int.jl:87 within `+`
      %18 = add nuw nsw &lt;4 x i64&gt; %vec.ind, &lt;i64 2, i64 2, i64 2, i64 2&gt;
; │└└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %19 = or i64 %index, 1
    %20 = getelementptr inbounds double, double* %arrayptr17, i64 %19
    %21 = bitcast double* %20 to &lt;4 x double&gt;*
    %wide.load = load &lt;4 x double&gt;, &lt;4 x double&gt;* %21, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %broadcast.splatinsert = insertelement &lt;4 x double&gt; poison, double %.pre, i64 0
   %broadcast.splat = shufflevector &lt;4 x double&gt; %broadcast.splatinsert, &lt;4 x double&gt; poison, &lt;4 x i32&gt; zeroinitializer
   %22 = fsub &lt;4 x double&gt; %wide.load, %broadcast.splat
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ promotion.jl:423 within `*`
; ││┌ @ promotion.jl:393 within `promote`
; │││┌ @ promotion.jl:370 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %broadcast.splatinsert36 = insertelement &lt;4 x double&gt; poison, double %.pre43, i64 0
        %broadcast.splat37 = shufflevector &lt;4 x double&gt; %broadcast.splatinsert36, &lt;4 x double&gt; poison, &lt;4 x i32&gt; zeroinitializer
        %23 = sitofp &lt;4 x i64&gt; %18 to &lt;4 x double&gt;
; │└└└└└
; │ @ simdloop.jl:75 within `macro expansion`
   %24 = fmul &lt;4 x double&gt; %broadcast.splat37, %23
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ float.jl:410 within `-`
    %25 = fsub &lt;4 x double&gt; %22, %24
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %broadcast.splatinsert39 = insertelement &lt;4 x double&gt; poison, double %.pre44, i64 0
    %broadcast.splat40 = shufflevector &lt;4 x double&gt; %broadcast.splatinsert39, &lt;4 x double&gt; poison, &lt;4 x i32&gt; zeroinitializer
    %26 = getelementptr inbounds double, double* %arrayptr17, i64 %index
    %27 = bitcast double* %26 to &lt;4 x double&gt;*
    %wide.load38 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %27, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %28 = fmul &lt;4 x double&gt; %broadcast.splat40, %wide.load38
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ float.jl:410 within `-`
    %29 = fsub &lt;4 x double&gt; %25, %28
; │└
; │┌ @ array.jl:1021 within `setindex!`
    %30 = getelementptr inbounds double, double* %arrayptr1622, i64 %index
    %31 = bitcast double* %30 to &lt;4 x double&gt;*
    store &lt;4 x double&gt; %29, &lt;4 x double&gt;* %31, align 8
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %index.next = or i64 %index, 4
; │└
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ range.jl:929 within `getindex`
; │││┌ @ int.jl:87 within `+`
      %32 = add &lt;4 x i64&gt; %vec.ind, &lt;i64 6, i64 6, i64 6, i64 6&gt;
; │└└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %33 = or i64 %index, 5
    %34 = getelementptr inbounds double, double* %arrayptr17, i64 %33
    %35 = bitcast double* %34 to &lt;4 x double&gt;*
    %wide.load.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %35, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %36 = fsub &lt;4 x double&gt; %wide.load.1, %broadcast.splat
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ promotion.jl:423 within `*`
; ││┌ @ promotion.jl:393 within `promote`
; │││┌ @ promotion.jl:370 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %37 = sitofp &lt;4 x i64&gt; %32 to &lt;4 x double&gt;
; │└└└└└
; │ @ simdloop.jl:75 within `macro expansion`
   %38 = fmul &lt;4 x double&gt; %broadcast.splat37, %37
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ float.jl:410 within `-`
    %39 = fsub &lt;4 x double&gt; %36, %38
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %40 = getelementptr inbounds double, double* %arrayptr17, i64 %index.next
    %41 = bitcast double* %40 to &lt;4 x double&gt;*
    %wide.load38.1 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %41, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %42 = fmul &lt;4 x double&gt; %broadcast.splat40, %wide.load38.1
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ float.jl:410 within `-`
    %43 = fsub &lt;4 x double&gt; %39, %42
; │└
; │┌ @ array.jl:1021 within `setindex!`
    %44 = getelementptr inbounds double, double* %arrayptr1622, i64 %index.next
    %45 = bitcast double* %44 to &lt;4 x double&gt;*
    store &lt;4 x double&gt; %43, &lt;4 x double&gt;* %45, align 8
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %index.next.1 = add nuw i64 %index, 8
    %vec.ind.next.1 = add &lt;4 x i64&gt; %vec.ind, &lt;i64 8, i64 8, i64 8, i64 8&gt;
    %niter.next.1 = add i64 %niter, 2
    %niter.ncmp.1 = icmp eq i64 %niter.next.1, %unroll_iter
    br i1 %niter.ncmp.1, label %middle.block.unr-lcssa.loopexit, label %vector.body

middle.block.unr-lcssa.loopexit:                  ; preds = %vector.body
    %phi.bo = add &lt;4 x i64&gt; %vec.ind, &lt;i64 10, i64 10, i64 10, i64 10&gt;
    %phi.cast = sitofp &lt;4 x i64&gt; %phi.bo to &lt;4 x double&gt;
    br label %middle.block.unr-lcssa

middle.block.unr-lcssa:                           ; preds = %middle.block.unr-lcssa.loopexit, %vector.ph
    %index.unr = phi i64 [ 0, %vector.ph ], [ %index.next.1, %middle.block.unr-lcssa.loopexit ]
    %vec.ind.unr = phi &lt;4 x double&gt; [ &lt;double 2.000000e+00, double 3.000000e+00, double 4.000000e+00, double 5.000000e+00&gt;, %vector.ph ], [ %phi.cast, %middle.block.unr-lcssa.loopexit ]
    %lcmp.mod.not = icmp eq i64 %xtraiter, 0
    br i1 %lcmp.mod.not, label %middle.block, label %vector.body.epil.preheader

vector.body.epil.preheader:                       ; preds = %middle.block.unr-lcssa
    %46 = or i64 %index.unr, 1
    %47 = getelementptr inbounds double, double* %arrayptr17, i64 %46
    %48 = bitcast double* %47 to &lt;4 x double&gt;*
    %wide.load.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %48, align 8
    %49 = load double, double* %arrayptr418, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %broadcast.splatinsert.epil = insertelement &lt;4 x double&gt; poison, double %49, i64 0
   %broadcast.splat.epil = shufflevector &lt;4 x double&gt; %broadcast.splatinsert.epil, &lt;4 x double&gt; poison, &lt;4 x i32&gt; zeroinitializer
   %50 = fsub &lt;4 x double&gt; %wide.load.epil, %broadcast.splat.epil
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %51 = load double, double* %12, align 8
; │└
; │┌ @ promotion.jl:423 within `*`
; ││┌ @ promotion.jl:393 within `promote`
; │││┌ @ promotion.jl:370 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %broadcast.splatinsert36.epil = insertelement &lt;4 x double&gt; poison, double %51, i64 0
        %broadcast.splat37.epil = shufflevector &lt;4 x double&gt; %broadcast.splatinsert36.epil, &lt;4 x double&gt; poison, &lt;4 x i32&gt; zeroinitializer
; │└└└└└
; │ @ simdloop.jl:75 within `macro expansion`
   %52 = fmul &lt;4 x double&gt; %broadcast.splat37.epil, %vec.ind.unr
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ float.jl:410 within `-`
    %53 = fsub &lt;4 x double&gt; %50, %52
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %54 = load double, double* %13, align 8
    %broadcast.splatinsert39.epil = insertelement &lt;4 x double&gt; poison, double %54, i64 0
    %broadcast.splat40.epil = shufflevector &lt;4 x double&gt; %broadcast.splatinsert39.epil, &lt;4 x double&gt; poison, &lt;4 x i32&gt; zeroinitializer
    %55 = getelementptr inbounds double, double* %arrayptr17, i64 %index.unr
    %56 = bitcast double* %55 to &lt;4 x double&gt;*
    %wide.load38.epil = load &lt;4 x double&gt;, &lt;4 x double&gt;* %56, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   %57 = fmul &lt;4 x double&gt; %broadcast.splat40.epil, %wide.load38.epil
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ float.jl:410 within `-`
    %58 = fsub &lt;4 x double&gt; %53, %57
; │└
; │┌ @ array.jl:1021 within `setindex!`
    %59 = getelementptr inbounds double, double* %arrayptr1622, i64 %index.unr
    %60 = bitcast double* %59 to &lt;4 x double&gt;*
    store &lt;4 x double&gt; %58, &lt;4 x double&gt;* %60, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   br label %middle.block

middle.block:                                     ; preds = %vector.body.epil.preheader, %middle.block.unr-lcssa
   %cmp.n = icmp eq i64 %4, %n.vec
   br i1 %cmp.n, label %L56, label %scalar.ph

scalar.ph:                                        ; preds = %middle.block, %vector.memcheck, %L19.lr.ph
   %bc.resume.val = phi i64 [ %n.vec, %middle.block ], [ 0, %L19.lr.ph ], [ 0, %vector.memcheck ]
   %61 = add nsw i64 %3, -2
   %xtraiter41 = and i64 %4, 1
   %lcmp.mod42.not = icmp eq i64 %xtraiter41, 0
   br i1 %lcmp.mod42.not, label %L19.prol.loopexit, label %L19.prol.preheader

L19.prol.preheader:                               ; preds = %scalar.ph
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ range.jl:929 within `getindex`
; │││┌ @ int.jl:87 within `+`
      %62 = or i64 %bc.resume.val, 2
; │└└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %63 = or i64 %bc.resume.val, 1
    %64 = getelementptr inbounds double, double* %arrayptr17, i64 %63
    %arrayref.prol = load double, double* %64, align 8
    %arrayref5.prol = load double, double* %arrayptr418, align 8
; │└
; │┌ @ float.jl:410 within `-`
    %65 = fsub double %arrayref.prol, %arrayref5.prol
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %arrayref8.prol = load double, double* %12, align 8
; │└
; │┌ @ promotion.jl:423 within `*`
; ││┌ @ promotion.jl:393 within `promote`
; │││┌ @ promotion.jl:370 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %66 = sitofp i64 %62 to double
; ││└└└└
; ││ @ promotion.jl:423 within `*` @ float.jl:411
    %67 = fmul double %arrayref8.prol, %66
; │└
; │┌ @ float.jl:410 within `-`
    %68 = fsub double %65, %67
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %arrayref11.prol = load double, double* %13, align 8
    %69 = getelementptr inbounds double, double* %arrayptr17, i64 %bc.resume.val
    %arrayref14.prol = load double, double* %69, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %70 = fmul double %arrayref11.prol, %arrayref14.prol
; │└
; │┌ @ float.jl:410 within `-`
    %71 = fsub double %68, %70
; │└
; │┌ @ array.jl:1021 within `setindex!`
    %72 = getelementptr inbounds double, double* %arrayptr1622, i64 %bc.resume.val
    store double %71, double* %72, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
   br label %L19.prol.loopexit

L19.prol.loopexit:                                ; preds = %L19.prol.preheader, %scalar.ph
   %value_phi124.unr = phi i64 [ %bc.resume.val, %scalar.ph ], [ %63, %L19.prol.preheader ]
   %73 = icmp eq i64 %61, %bc.resume.val
   br i1 %73, label %L56, label %L19

L19:                                              ; preds = %L19, %L19.prol.loopexit
   %value_phi124 = phi i64 [ %74, %L19 ], [ %value_phi124.unr, %L19.prol.loopexit ]
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ range.jl:929 within `getindex`
; │││┌ @ int.jl:87 within `+`
      %74 = add nuw nsw i64 %value_phi124, 2
; │└└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %75 = add nuw nsw i64 %value_phi124, 1
    %76 = getelementptr inbounds double, double* %arrayptr17, i64 %75
    %arrayref = load double, double* %76, align 8
    %arrayref5 = load double, double* %arrayptr418, align 8
; │└
; │┌ @ float.jl:410 within `-`
    %77 = fsub double %arrayref, %arrayref5
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %arrayref8 = load double, double* %12, align 8
; │└
; │┌ @ promotion.jl:423 within `*`
; ││┌ @ promotion.jl:393 within `promote`
; │││┌ @ promotion.jl:370 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %78 = sitofp i64 %74 to double
; ││└└└└
; ││ @ promotion.jl:423 within `*` @ float.jl:411
    %79 = fmul double %arrayref8, %78
; │└
; │┌ @ float.jl:410 within `-`
    %80 = fsub double %77, %79
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %arrayref11 = load double, double* %13, align 8
    %81 = getelementptr inbounds double, double* %arrayptr17, i64 %value_phi124
    %arrayref14 = load double, double* %81, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %82 = fmul double %arrayref11, %arrayref14
; │└
; │┌ @ float.jl:410 within `-`
    %83 = fsub double %80, %82
; │└
; │┌ @ array.jl:1021 within `setindex!`
    %84 = getelementptr inbounds double, double* %arrayptr1622, i64 %value_phi124
    store double %83, double* %84, align 8
; │└
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ range.jl:929 within `getindex`
; │││┌ @ int.jl:87 within `+`
      %85 = add nuw nsw i64 %value_phi124, 3
; │└└└
; │ @ simdloop.jl:77 within `macro expansion` @ In[29]:4
; │┌ @ essentials.jl:13 within `getindex`
    %86 = getelementptr inbounds double, double* %arrayptr17, i64 %74
    %arrayref.1 = load double, double* %86, align 8
    %arrayref5.1 = load double, double* %arrayptr418, align 8
; │└
; │┌ @ float.jl:410 within `-`
    %87 = fsub double %arrayref.1, %arrayref5.1
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %arrayref8.1 = load double, double* %12, align 8
; │└
; │┌ @ promotion.jl:423 within `*`
; ││┌ @ promotion.jl:393 within `promote`
; │││┌ @ promotion.jl:370 within `_promote`
; ││││┌ @ number.jl:7 within `convert`
; │││││┌ @ float.jl:159 within `Float64`
        %88 = sitofp i64 %85 to double
; ││└└└└
; ││ @ promotion.jl:423 within `*` @ float.jl:411
    %89 = fmul double %arrayref8.1, %88
; │└
; │┌ @ float.jl:410 within `-`
    %90 = fsub double %87, %89
; │└
; │┌ @ essentials.jl:13 within `getindex`
    %arrayref11.1 = load double, double* %13, align 8
    %arrayref14.1 = load double, double* %76, align 8
; │└
; │┌ @ float.jl:411 within `*`
    %91 = fmul double %arrayref11.1, %arrayref14.1
; │└
; │┌ @ float.jl:410 within `-`
    %92 = fsub double %90, %91
; │└
; │┌ @ array.jl:1021 within `setindex!`
    %93 = getelementptr inbounds double, double* %arrayptr1622, i64 %75
    store double %92, double* %93, align 8
; │└
; │ @ simdloop.jl:75 within `macro expansion`
; │┌ @ int.jl:83 within `&lt;`
    %exitcond.not.1 = icmp eq i64 %74, %4
; │└
   br i1 %exitcond.not.1, label %L56, label %L19

L56:                                              ; preds = %L19, %L19.prol.loopexit, %middle.block, %top
; │ @ simdloop.jl:76 within `macro expansion`
; │┌ @ simdloop.jl:54 within `simd_index`
; ││┌ @ range.jl:930 within `getindex`
     ret {}* inttoptr (i64 123747077980168 to {}*)
; └└└
}</code></pre>
</div>
</div>
<div id="d4366923" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a></a><span class="pp">@benchmark</span> <span class="fu">resids!</span>(<span class="op">$</span>e,<span class="op">$</span>y,<span class="op">$</span>θ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 56 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">873.482 ns</span> … <span class="ansi-magenta-fg"> 1.805 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">876.554 ns              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">923.187 ns</span> ± <span class="ansi-green-fg">73.594 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  █<span class="ansi-blue-fg"> </span>      <span class="ansi-green-fg"> </span>▇   ▂▆    ▄    ▁▁                                   ▂
  █<span class="ansi-blue-fg">▁</span>▁▁▁▁▁▁<span class="ansi-green-fg">▇</span>█▅▇▇██▅▅▃▁█▆▅▅▆██▅▅▄▃██▅▅▅▅▅▄▄▅▆▆▇▆█▅▅▆▆▆▆▅▅▆▆▆▇▇▇▆ █
  873 ns<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      1.24 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="9f0373f4" class="cell" data-execution_count="30">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb41-1"><a></a><span class="kw">function</span> <span class="fu">resids_turbo!</span>(<span class="cn">e</span>, yin, θ)</span>
<span id="cb41-2"><a></a>  T <span class="op">=</span> <span class="fu">length</span>(yin)</span>
<span id="cb41-3"><a></a>  <span class="pp">@turbo</span> <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>T</span>
<span id="cb41-4"><a></a>    <span class="cn">e</span>[t<span class="op">-</span><span class="fl">1</span>] <span class="op">=</span> yin[t] <span class="op">-</span> θ[<span class="fl">1</span>] <span class="op">-</span> θ[<span class="fl">2</span>]<span class="op">*</span>t <span class="op">-</span> θ[<span class="fl">3</span>]<span class="op">*</span>yin[t<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb41-5"><a></a>  <span class="cf">end</span></span>
<span id="cb41-6"><a></a>  <span class="cn">nothing</span></span>
<span id="cb41-7"><a></a><span class="kw">end</span></span>
<span id="cb41-8"><a></a></span>
<span id="cb41-9"><a></a><span class="pp">@code_llvm</span> <span class="fu">resids_turbo!</span>(<span class="cn">e</span>,y, θ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>;  @ In[31]:1 within `resids_turbo!`
define nonnull {}* @"japi1_resids_turbo!_5523"({}* %function, {}** noalias nocapture noundef readonly %args, i32 %nargs) #0 {
top:
  %stackargs = alloca {}**, align 8
  store volatile {}** %args, {}*** %stackargs, align 8
  %0 = bitcast {}** %args to double***
  %1 = load double**, double*** %0, align 8
  %2 = getelementptr inbounds {}*, {}** %args, i64 1
  %3 = load {}*, {}** %2, align 8
  %4 = getelementptr inbounds {}*, {}** %args, i64 2
  %5 = bitcast {}** %4 to double***
  %6 = load double**, double*** %5, align 8
;  @ In[31]:2 within `resids_turbo!`
; ┌ @ essentials.jl:10 within `length`
   %7 = bitcast {}* %3 to { i8*, i64, i16, i16, i32 }*
   %arraylen_ptr = getelementptr inbounds { i8*, i64, i16, i16, i32 }, { i8*, i64, i16, i16, i32 }* %7, i64 0, i32 1
   %arraylen = load i64, i64* %arraylen_ptr, align 8
; └
;  @ In[31]:3 within `resids_turbo!`
; ┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/condense_loopset.jl:1179 within `macro expansion`
; │┌ @ /home/paul/.julia/packages/LayoutPointers/v9n88/src/stridedpointers.jl:100 within `stridedpointer_preserve`
; ││┌ @ /home/paul/.julia/packages/LayoutPointers/v9n88/src/stridedpointers.jl:18 within `memory_reference` @ /home/paul/.julia/packages/LayoutPointers/v9n88/src/stridedpointers.jl:21
; │││┌ @ abstractarray.jl:1237 within `pointer`
; ││││┌ @ pointer.jl:65 within `unsafe_convert`
       %arrayptr225 = load double*, double** %1, align 8
; │└└└└
; │┌ @ abstractarray.jl:1291 within `getindex`
; ││┌ @ abstractarray.jl:1319 within `_getindex`
; │││┌ @ essentials.jl:13 within `getindex`
      %arrayptr25221 = load double*, double** %6, align 8
      %8 = getelementptr inbounds double, double* %arrayptr25221, i64 1
      %arrayref = load double, double* %8, align 8
      %9 = getelementptr inbounds double, double* %arrayptr25221, i64 2
      %arrayref28 = load double, double* %9, align 8
; │└└└
; │┌ @ /home/paul/.julia/packages/LayoutPointers/v9n88/src/stridedpointers.jl:100 within `stridedpointer_preserve`
; ││┌ @ /home/paul/.julia/packages/LayoutPointers/v9n88/src/stridedpointers.jl:18 within `memory_reference` @ /home/paul/.julia/packages/LayoutPointers/v9n88/src/stridedpointers.jl:21
; │││┌ @ abstractarray.jl:1237 within `pointer`
; ││││┌ @ pointer.jl:65 within `unsafe_convert`
       %10 = bitcast {}* %3 to double**
       %arrayptr30224 = load double*, double** %10, align 8
; │└└└└
; │┌ @ abstractarray.jl:1291 within `getindex`
; ││┌ @ abstractarray.jl:1319 within `_getindex`
; │││┌ @ essentials.jl:13 within `getindex`
      %arrayref33 = load double, double* %arrayptr25221, align 8
; │└└└
; │┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/condense_loopset.jl:390 within `gespf1`
; ││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:479 within `gesp`
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:442 within `increment_ptr`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:407 within `_gep`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:407 within `macro expansion`
        %ptr.1.i = getelementptr inbounds double, double* %arrayptr30224, i64 -2
        %ptr.1.i37 = getelementptr inbounds double, double* %arrayptr225, i64 -2
; │└└└└└
; │┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/reconstruct_loopset.jl:1107 within `_turbo_!`
; ││┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/reconstruct_loopset.jl:1107 within `macro expansion`
; │││┌ @ operators.jl:425 within `&gt;=`
; ││││┌ @ operators.jl:401 within `&lt;=`
; │││││┌ @ bool.jl:39 within `|`
        %11 = icmp ugt i64 %arraylen, 1
; │││└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:47 within `assume`
      call void @llvm.assume(i1 %11)
; │││└
; │││┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/modeling/graphs.jl:236 within `vcmpend`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `vsub_nsw`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
        %res.i = add nsw i64 %arraylen, -11
; ││││└└
; ││││┌ @ int.jl:514 within `&lt;=`
       %.not232 = icmp ult i64 %arraylen, 13
; │││└└
     br i1 %.not232, label %L134, label %L97.lr.ph

L97.lr.ph:                                        ; preds = %top
     %ie.i = insertelement &lt;4 x double&gt; undef, double %arrayref33, i64 0
     %v.i = shufflevector &lt;4 x double&gt; %ie.i, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
     %12 = fneg fast double %arrayref28
     %ie.i63 = insertelement &lt;4 x double&gt; undef, double %12, i64 0
     %v.i64 = shufflevector &lt;4 x double&gt; %ie.i63, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
     %13 = fneg fast double %arrayref
     %ie.i70 = insertelement &lt;4 x double&gt; undef, double %13, i64 0
     %v.i71 = shufflevector &lt;4 x double&gt; %ie.i70, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
     br label %L97

L97:                                              ; preds = %L97, %L97.lr.ph
     %value_phi35233 = phi i64 [ 2, %L97.lr.ph ], [ %res.i91, %L97 ]
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:771 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:535 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i39 = getelementptr inbounds double, double* %ptr.1.i, i64 %value_phi35233
; ││││││└└└
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:95 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `macro expansion`
           %ptr.1.i41 = bitcast double* %ptr.1.i39 to &lt;4 x double&gt;*
           %res.i42 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.1.i41, align 8
           %ptr.1.i43 = getelementptr inbounds double, double* %ptr.1.i39, i64 4
           %ptr.2.i44 = bitcast double* %ptr.1.i43 to &lt;4 x double&gt;*
           %res.i45 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.2.i44, align 8
           %ptr.1.i46 = getelementptr inbounds double, double* %ptr.1.i39, i64 8
           %ptr.2.i47 = bitcast double* %ptr.1.i46 to &lt;4 x double&gt;*
           %res.i48 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.2.i47, align 8
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:55 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i49 = or i64 %value_phi35233, 1
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:771 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:535 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i50 = getelementptr inbounds double, double* %ptr.1.i, i64 %res.i49
; ││││││└└└
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:95 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `macro expansion`
           %ptr.1.i52 = bitcast double* %ptr.1.i50 to &lt;4 x double&gt;*
           %res.i53 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.1.i52, align 8
           %ptr.1.i54 = getelementptr inbounds double, double* %ptr.1.i50, i64 4
           %ptr.2.i55 = bitcast double* %ptr.1.i54 to &lt;4 x double&gt;*
           %res.i56 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.2.i55, align 8
           %ptr.1.i57 = getelementptr inbounds double, double* %ptr.1.i50, i64 8
           %ptr.2.i58 = bitcast double* %ptr.1.i57 to &lt;4 x double&gt;*
           %res.i59 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.2.i58, align 8
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:99 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:111 within `vsub_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i60 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i53, %v.i
; ││││││└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i61 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i56, %v.i
; ││││││└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:7
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i62 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i59, %v.i
; │││└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:233
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `fmap`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `vmuladd_fast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
            %res.i65 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i64, &lt;4 x double&gt; %res.i42, &lt;4 x double&gt; %res.i60)
            %res.i66 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i64, &lt;4 x double&gt; %res.i45, &lt;4 x double&gt; %res.i61)
            %res.i67 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i64, &lt;4 x double&gt; %res.i48, &lt;4 x double&gt; %res.i62)
; │││└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vector_width.jl:45 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i68 = add nuw nsw i64 %value_phi35233, 4
       %res.i69 = add nuw nsw i64 %value_phi35233, 8
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:203 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:254 within `vconvert`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %14 = sitofp i64 %value_phi35233 to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i72 = insertelement &lt;4 x double&gt; undef, double %14, i64 0
               %v.i73 = shufflevector &lt;4 x double&gt; %ie.i72, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i74 = fadd fast &lt;4 x double&gt; %v.i73, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││││││└└└
; ││││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %15 = sitofp i64 %res.i68 to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i75 = insertelement &lt;4 x double&gt; undef, double %15, i64 0
               %v.i76 = shufflevector &lt;4 x double&gt; %ie.i75, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i77 = fadd fast &lt;4 x double&gt; %v.i76, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││││││└└└
; ││││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:10
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %16 = sitofp i64 %res.i69 to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i78 = insertelement &lt;4 x double&gt; undef, double %16, i64 0
               %v.i79 = shufflevector &lt;4 x double&gt; %ie.i78, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i80 = fadd fast &lt;4 x double&gt; %v.i79, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││└└└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:233
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `fmap`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `vmuladd_fast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
            %res.i81 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i71, &lt;4 x double&gt; %res.i74, &lt;4 x double&gt; %res.i65)
            %res.i82 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i71, &lt;4 x double&gt; %res.i77, &lt;4 x double&gt; %res.i66)
            %res.i83 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i71, &lt;4 x double&gt; %res.i80, &lt;4 x double&gt; %res.i67)
; │││└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:1803 within `_vstore!`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:1174 within `_vstore_unroll!`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:870 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i84 = getelementptr inbounds double, double* %ptr.1.i37, i64 %value_phi35233
; ││││││└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:872 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:199 within `_vstore!`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1482 within `__vstore!`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1482 within `macro expansion`
           %ptr.1.i86 = bitcast double* %ptr.1.i84 to &lt;4 x double&gt;*
           store &lt;4 x double&gt; %res.i81, &lt;4 x double&gt;* %ptr.1.i86, align 8
           %ptr.1.i87 = getelementptr inbounds double, double* %ptr.1.i84, i64 4
           %ptr.2.i88 = bitcast double* %ptr.1.i87 to &lt;4 x double&gt;*
           store &lt;4 x double&gt; %res.i82, &lt;4 x double&gt;* %ptr.2.i88, align 8
           %ptr.1.i89 = getelementptr inbounds double, double* %ptr.1.i84, i64 8
           %ptr.2.i90 = bitcast double* %ptr.1.i89 to &lt;4 x double&gt;*
           store &lt;4 x double&gt; %res.i83, &lt;4 x double&gt;* %ptr.2.i90, align 8
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i91 = add nuw nsw i64 %value_phi35233, 12
; │││└└
; │││┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/modeling/graphs.jl:236 within `vcmpend`
; ││││┌ @ int.jl:514 within `&lt;=`
       %.not = icmp sgt i64 %res.i91, %res.i
; │││└└
     br i1 %.not, label %L134, label %L97

L134:                                             ; preds = %L97, %top
     %value_phi35.lcssa = phi i64 [ 2, %top ], [ %res.i91, %L97 ]
; │││┌ @ /home/paul/.julia/packages/LoopVectorization/QgYWB/src/modeling/graphs.jl:229 within `cmpend`
; ││││┌ @ int.jl:514 within `&lt;=`
       %.not226 = icmp ugt i64 %value_phi35.lcssa, %arraylen
; │││└└
     br i1 %.not226, label %L233, label %L136

L136:                                             ; preds = %L134
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:553 within `mask`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:520 within `_mask`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:520 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:503 within `_mask_cmp`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:499 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:53 within `vsub_nw`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:53 within `macro expansion`
            %res.i92 = add nuw i64 %arraylen, 2
; ││││││││└└
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:386 within `valrem`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:386 within `macro expansion`
; ││││││││││┌ @ int.jl:347 within `&amp;`
             %17 = and i64 %res.i92, 3
; ││││││││└└└
; ││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:500 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:93 within `&gt;=`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:810 within `vge`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/promotion.jl:141 within `itosize`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:209 within `rem`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:461 within `vrem`
; │││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:195 within `vconvert`
; │││││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; ││││││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
                   %ie.i93 = insertelement &lt;4 x i64&gt; undef, i64 %17, i64 0
                   %v.i94 = shufflevector &lt;4 x i64&gt; %ie.i93, &lt;4 x i64&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││││││└└└└└└└
; ││││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:810 within `vge` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:730
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/masks.jl:690 within `macro expansion`
             %m.i = icmp uge &lt;4 x i64&gt; %v.i94, &lt;i64 0, i64 1, i64 2, i64 3&gt;
; │││└└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:55 within `vsub_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i96 = add nsw i64 %arraylen, -4
; │││└└
; │││┌ @ operators.jl:378 within `&gt;`
; ││││┌ @ int.jl:83 within `&lt;`
       %.not227 = icmp slt i64 %res.i96, %value_phi35.lcssa
; │││└└
     br i1 %.not227, label %L146, label %L165

L146:                                             ; preds = %L136
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:105 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `__vload`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `macro expansion`
        %ptr.1.i99228 = getelementptr inbounds double, double* %ptr.1.i, i64 %value_phi35.lcssa
        %ptr.2.i100 = bitcast double* %ptr.1.i99228 to &lt;4 x double&gt;*
        %res.i101 = call &lt;4 x double&gt; @llvm.masked.load.v4f64.p0v4f64(&lt;4 x double&gt;* nonnull %ptr.2.i100, i32 8, &lt;4 x i1&gt; %m.i, &lt;4 x double&gt; zeroinitializer)
; ││││└└
; ││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:104 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:45 within `linear_index`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/cartesian_indexing.jl:5 within `tdot` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/cartesian_indexing.jl:9
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/lazymul.jl:61 within `lazymul`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 within `vmul_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
           %res.i102 = shl i64 %value_phi35.lcssa, 3
           %res.i103 = add nuw nsw i64 %res.i102, 8
; ││││└└└└└
; ││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:105 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `__vload`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `macro expansion`
        %ptr.0.i104 = bitcast double* %ptr.1.i to i8*
        %ptr.1.i105 = getelementptr inbounds i8, i8* %ptr.0.i104, i64 %res.i103
        %ptr.2.i106 = bitcast i8* %ptr.1.i105 to &lt;4 x double&gt;*
        %res.i107 = call &lt;4 x double&gt; @llvm.masked.load.v4f64.p0v4f64(&lt;4 x double&gt;* nonnull %ptr.2.i106, i32 8, &lt;4 x i1&gt; %m.i, &lt;4 x double&gt; zeroinitializer)
; │││└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:94 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:96 within `promote`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191 within `vconvert`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
            %ie.i108 = insertelement &lt;4 x double&gt; undef, double %arrayref33, i64 0
            %v.i109 = shufflevector &lt;4 x double&gt; %ie.i108, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││└└└└└└
; ││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:95 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
        %res.i110 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i107, %v.i109
; │││└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ fastmath.jl:161 within `sub_fast`
       %18 = fneg fast double %arrayref28
; ││││└
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191 within `vconvert`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
              %ie.i111 = insertelement &lt;4 x double&gt; undef, double %18, i64 0
              %v.i112 = shufflevector &lt;4 x double&gt; %ie.i111, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││└└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
         %res.i113 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i112, &lt;4 x double&gt; %res.i101, &lt;4 x double&gt; %res.i110)
; ││││└└└
; ││││┌ @ fastmath.jl:161 within `sub_fast`
       %19 = fneg fast double %arrayref
; ││││└
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191 within `vconvert`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
              %ie.i114 = insertelement &lt;4 x double&gt; undef, double %19, i64 0
              %v.i115 = shufflevector &lt;4 x double&gt; %ie.i114, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││││└└└└
; ││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:203 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││┌ @ number.jl:7 within `convert`
; ││││││││││┌ @ float.jl:159 within `Float64`
             %20 = sitofp i64 %value_phi35.lcssa to double
; │││││││││└└
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
             %ie.i116 = insertelement &lt;4 x double&gt; undef, double %20, i64 0
             %v.i117 = shufflevector &lt;4 x double&gt; %ie.i116, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
             %res.i118 = fadd fast &lt;4 x double&gt; %v.i117, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
         %res.i119 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i115, &lt;4 x double&gt; %res.i118, &lt;4 x double&gt; %res.i113)
; │││└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:212 within `_vstore!`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1667 within `__vstore!`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1667 within `macro expansion`
        %ptr.1.i122229 = getelementptr inbounds double, double* %ptr.1.i37, i64 %value_phi35.lcssa
        %ptr.2.i123 = bitcast double* %ptr.1.i122229 to &lt;4 x double&gt;*
        call void @llvm.masked.store.v4f64.p0v4f64(&lt;4 x double&gt; %res.i119, &lt;4 x double&gt;* nonnull %ptr.2.i123, i32 8, &lt;4 x i1&gt; %m.i)
; │││└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       br label %L233

L165:                                             ; preds = %L136
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:55 within `vsub_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i125 = add nsw i64 %arraylen, -8
; │││└└
; │││┌ @ operators.jl:378 within `&gt;`
; ││││┌ @ int.jl:83 within `&lt;`
       %.not230 = icmp slt i64 %res.i125, %value_phi35.lcssa
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:788 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:659 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i126 = getelementptr inbounds double, double* %ptr.1.i, i64 %value_phi35.lcssa
; ││││││└└└
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:95 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `macro expansion`
           %ptr.1.i128 = bitcast double* %ptr.1.i126 to &lt;4 x double&gt;*
           %res.i129 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.1.i128, align 8
; │││││││└└
; │││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl within `_vload`
         %ptr.1.i130 = getelementptr inbounds double, double* %ptr.1.i126, i64 4
         %ptr.2.i131 = bitcast double* %ptr.1.i130 to &lt;4 x double&gt;*
; │││└└└└
     br i1 %.not230, label %L168, label %L196

L168:                                             ; preds = %L165
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:788 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:659 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:105 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `macro expansion`
           %res.i132 = call &lt;4 x double&gt; @llvm.masked.load.v4f64.p0v4f64(&lt;4 x double&gt;* nonnull %ptr.2.i131, i32 8, &lt;4 x i1&gt; %m.i, &lt;4 x double&gt; zeroinitializer)
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:55 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i133 = or i64 %value_phi35.lcssa, 1
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:788 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:659 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i134 = getelementptr inbounds double, double* %ptr.1.i, i64 %res.i133
; ││││││└└└
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:95 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `macro expansion`
           %ptr.1.i136 = bitcast double* %ptr.1.i134 to &lt;4 x double&gt;*
           %res.i137 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.1.i136, align 8
; │││││││└└
; │││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:105 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `macro expansion`
           %ptr.1.i138 = getelementptr inbounds double, double* %ptr.1.i134, i64 4
           %ptr.2.i139 = bitcast double* %ptr.1.i138 to &lt;4 x double&gt;*
           %res.i140 = call &lt;4 x double&gt; @llvm.masked.load.v4f64.p0v4f64(&lt;4 x double&gt;* nonnull %ptr.2.i139, i32 8, &lt;4 x i1&gt; %m.i, &lt;4 x double&gt; zeroinitializer)
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:98 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:96 within `promote`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:242 within `vconvert` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
            %ie.i141 = insertelement &lt;4 x double&gt; undef, double %arrayref33, i64 0
            %v.i142 = shufflevector &lt;4 x double&gt; %ie.i141, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││└└└└└└
; ││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:99 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:111 within `vsub_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i143 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i137, %v.i142
; ││││││└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:7
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i144 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i140, %v.i142
; │││└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ fastmath.jl:161 within `sub_fast`
       %21 = fneg fast double %arrayref28
; ││││└
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:242 within `vconvert` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
              %ie.i145 = insertelement &lt;4 x double&gt; undef, double %21, i64 0
              %v.i146 = shufflevector &lt;4 x double&gt; %ie.i145, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││└└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:233
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `fmap`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `vmuladd_fast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
            %res.i147 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i146, &lt;4 x double&gt; %res.i129, &lt;4 x double&gt; %res.i143)
            %res.i148 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i146, &lt;4 x double&gt; %res.i132, &lt;4 x double&gt; %res.i144)
; │││└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vector_width.jl:45 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i149 = add nuw nsw i64 %value_phi35.lcssa, 4
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ fastmath.jl:161 within `sub_fast`
       %22 = fneg fast double %arrayref
; ││││└
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:242 within `vconvert` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
              %ie.i150 = insertelement &lt;4 x double&gt; undef, double %22, i64 0
              %v.i151 = shufflevector &lt;4 x double&gt; %ie.i150, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││││└└└└
; ││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:203 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:254 within `vconvert`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %23 = sitofp i64 %value_phi35.lcssa to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i152 = insertelement &lt;4 x double&gt; undef, double %23, i64 0
               %v.i153 = shufflevector &lt;4 x double&gt; %ie.i152, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i154 = fadd fast &lt;4 x double&gt; %v.i153, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││││││└└└
; ││││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:10
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %24 = sitofp i64 %res.i149 to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i155 = insertelement &lt;4 x double&gt; undef, double %24, i64 0
               %v.i156 = shufflevector &lt;4 x double&gt; %ie.i155, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i157 = fadd fast &lt;4 x double&gt; %v.i156, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││└└└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:233
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `fmap`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `vmuladd_fast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
            %res.i158 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i151, &lt;4 x double&gt; %res.i154, &lt;4 x double&gt; %res.i147)
            %res.i159 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i151, &lt;4 x double&gt; %res.i157, &lt;4 x double&gt; %res.i148)
; │││└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:1826 within `_vstore!`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:1473 within `_vstore_unroll!`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:870 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i160 = getelementptr inbounds double, double* %ptr.1.i37, i64 %value_phi35.lcssa
; ││││││└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:872 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:199 within `_vstore!`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1482 within `__vstore!`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1482 within `macro expansion`
           %ptr.1.i162 = bitcast double* %ptr.1.i160 to &lt;4 x double&gt;*
           store &lt;4 x double&gt; %res.i158, &lt;4 x double&gt;* %ptr.1.i162, align 8
; │││││││└└
; │││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:212 within `_vstore!`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1667 within `__vstore!`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1667 within `macro expansion`
           %ptr.1.i163 = getelementptr inbounds double, double* %ptr.1.i160, i64 4
           %ptr.2.i164 = bitcast double* %ptr.1.i163 to &lt;4 x double&gt;*
           call void @llvm.masked.store.v4f64.p0v4f64(&lt;4 x double&gt; %res.i159, &lt;4 x double&gt;* nonnull %ptr.2.i164, i32 8, &lt;4 x i1&gt; %m.i)
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       br label %L233

L196:                                             ; preds = %L165
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:788 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:659 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:95 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `macro expansion`
           %res.i172 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.2.i131, align 8
; │││││││└└
; │││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:105 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `macro expansion`
           %ptr.1.i173 = getelementptr inbounds double, double* %ptr.1.i126, i64 8
           %ptr.2.i174 = bitcast double* %ptr.1.i173 to &lt;4 x double&gt;*
           %res.i175 = call &lt;4 x double&gt; @llvm.masked.load.v4f64.p0v4f64(&lt;4 x double&gt;* nonnull %ptr.2.i174, i32 8, &lt;4 x i1&gt; %m.i, &lt;4 x double&gt; zeroinitializer)
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:55 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i176 = or i64 %value_phi35.lcssa, 1
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:788 within `_vload`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:659 within `_vload_unroll`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:60 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i177 = getelementptr inbounds double, double* %ptr.1.i, i64 %res.i176
; ││││││└└└
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:95 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:987 within `macro expansion`
           %ptr.1.i179 = bitcast double* %ptr.1.i177 to &lt;4 x double&gt;*
           %res.i180 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.1.i179, align 8
           %ptr.1.i181 = getelementptr inbounds double, double* %ptr.1.i177, i64 4
           %ptr.2.i182 = bitcast double* %ptr.1.i181 to &lt;4 x double&gt;*
           %res.i183 = load &lt;4 x double&gt;, &lt;4 x double&gt;* %ptr.2.i182, align 8
; │││││││└└
; │││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:105 within `_vload`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `__vload`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:997 within `macro expansion`
           %ptr.1.i184 = getelementptr inbounds double, double* %ptr.1.i177, i64 8
           %ptr.2.i185 = bitcast double* %ptr.1.i184 to &lt;4 x double&gt;*
           %res.i186 = call &lt;4 x double&gt; @llvm.masked.load.v4f64.p0v4f64(&lt;4 x double&gt;* nonnull %ptr.2.i185, i32 8, &lt;4 x i1&gt; %m.i, &lt;4 x double&gt; zeroinitializer)
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:98 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:96 within `promote`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:242 within `vconvert` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
            %ie.i187 = insertelement &lt;4 x double&gt; undef, double %arrayref33, i64 0
            %v.i188 = shufflevector &lt;4 x double&gt; %ie.i187, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││└└└└└└
; ││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:99 within `sub_fast`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:111 within `vsub_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i189 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i180, %v.i188
; ││││││└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i190 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i183, %v.i188
; ││││││└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:11 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:7
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `vsub_fast`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:116 within `macro expansion`
          %res.i191 = fsub reassoc nsz arcp contract afn &lt;4 x double&gt; %res.i186, %v.i188
; │││└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ fastmath.jl:161 within `sub_fast`
       %25 = fneg fast double %arrayref28
; ││││└
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:242 within `vconvert` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
              %ie.i192 = insertelement &lt;4 x double&gt; undef, double %25, i64 0
              %v.i193 = shufflevector &lt;4 x double&gt; %ie.i192, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││└└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:233
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `fmap`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `vmuladd_fast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
            %res.i194 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i193, &lt;4 x double&gt; %res.i129, &lt;4 x double&gt; %res.i189)
            %res.i195 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i193, &lt;4 x double&gt; %res.i172, &lt;4 x double&gt; %res.i190)
            %res.i196 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i193, &lt;4 x double&gt; %res.i175, &lt;4 x double&gt; %res.i191)
; │││└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vector_width.jl:45 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       %res.i197 = add nuw nsw i64 %value_phi35.lcssa, 4
       %res.i198 = add nuw nsw i64 %value_phi35.lcssa, 8
; │││└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:498 within `vfnmadd_fast`
; ││││┌ @ fastmath.jl:161 within `sub_fast`
       %26 = fneg fast double %arrayref
; ││││└
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:493 within `vfmadd_fast`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:392 within `vmuladd_fast`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/VectorizationBase.jl:100 within `promote`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:199 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:242 within `vconvert` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:191
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:151 within `vbroadcast`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:122 within `_vbroadcast`
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/vbroadcast.jl:95 within `macro expansion`
              %ie.i199 = insertelement &lt;4 x double&gt; undef, double %26, i64 0
              %v.i200 = shufflevector &lt;4 x double&gt; %ie.i199, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
; ││││││││└└└└
; ││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:203 within `convert`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/conversion.jl:254 within `vconvert`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap`
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %27 = sitofp i64 %value_phi35.lcssa to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i201 = insertelement &lt;4 x double&gt; undef, double %27, i64 0
               %v.i202 = shufflevector &lt;4 x double&gt; %ie.i201, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i203 = fadd fast &lt;4 x double&gt; %v.i202, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││││││└└└
; ││││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %28 = sitofp i64 %res.i197 to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i204 = insertelement &lt;4 x double&gt; undef, double %28, i64 0
               %v.i205 = shufflevector &lt;4 x double&gt; %ie.i204, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i206 = fadd fast &lt;4 x double&gt; %v.i205, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││││││└└└
; ││││││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 within `fmap` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:18 @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:10
; ││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:140 within `vconvert`
; │││││││││││┌ @ number.jl:7 within `convert`
; ││││││││││││┌ @ float.jl:159 within `Float64`
               %29 = sitofp i64 %res.i198 to double
; │││││││││││└└
; │││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:72 within `vrangeincr`
; ││││││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/ranges.jl:94 within `macro expansion`
               %ie.i207 = insertelement &lt;4 x double&gt; undef, double %29, i64 0
               %v.i208 = shufflevector &lt;4 x double&gt; %ie.i207, &lt;4 x double&gt; undef, &lt;4 x i32&gt; zeroinitializer
               %res.i209 = fadd fast &lt;4 x double&gt; %v.i208, &lt;double 0.000000e+00, double 1.000000e+00, double 2.000000e+00, double 3.000000e+00&gt;
; ││││││└└└└└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/base_defs.jl:393 within `vmuladd_fast` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:233
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `fmap`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/fmap.jl:25 within `macro expansion`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `vmuladd_fast`
; │││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/intrin_funcs.jl:438 within `macro expansion`
            %res.i210 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i200, &lt;4 x double&gt; %res.i203, &lt;4 x double&gt; %res.i194)
            %res.i211 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i200, &lt;4 x double&gt; %res.i206, &lt;4 x double&gt; %res.i195)
            %res.i212 = call reassoc nsz arcp contract afn &lt;4 x double&gt; @llvm.fmuladd.v4f64(&lt;4 x double&gt; %v.i200, &lt;4 x double&gt; %res.i209, &lt;4 x double&gt; %res.i196)
; │││└└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:1826 within `_vstore!`
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:1473 within `_vstore_unroll!`
; │││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:870 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:436 within `gep`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `_gep`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:414 within `macro expansion`
           %ptr.1.i213 = getelementptr inbounds double, double* %ptr.1.i37, i64 %value_phi35.lcssa
; ││││││└└└
; ││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/vecunroll/memory.jl:872 within `macro expansion`
; ││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:199 within `_vstore!`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1482 within `__vstore!`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1482 within `macro expansion`
           %ptr.1.i215 = bitcast double* %ptr.1.i213 to &lt;4 x double&gt;*
           store &lt;4 x double&gt; %res.i210, &lt;4 x double&gt;* %ptr.1.i215, align 8
           %ptr.1.i216 = getelementptr inbounds double, double* %ptr.1.i213, i64 4
           %ptr.2.i217 = bitcast double* %ptr.1.i216 to &lt;4 x double&gt;*
           store &lt;4 x double&gt; %res.i211, &lt;4 x double&gt;* %ptr.2.i217, align 8
; │││││││└└
; │││││││ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/strided_pointers/stridedpointers.jl:212 within `_vstore!`
; │││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1667 within `__vstore!`
; ││││││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/memory_addr.jl:1667 within `macro expansion`
           %ptr.1.i218 = getelementptr inbounds double, double* %ptr.1.i213, i64 8
           %ptr.2.i219 = bitcast double* %ptr.1.i218 to &lt;4 x double&gt;*
           call void @llvm.masked.store.v4f64.p0v4f64(&lt;4 x double&gt; %res.i212, &lt;4 x double&gt;* nonnull %ptr.2.i219, i32 8, &lt;4 x i1&gt; %m.i)
; │││└└└└└└
; │││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/static.jl:53 within `vadd_nsw` @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49
; ││││┌ @ /home/paul/.julia/packages/VectorizationBase/6AO0m/src/llvm_intrin/binary_ops.jl:49 within `macro expansion`
       br label %L233

L233:                                             ; preds = %L196, %L168, %L146, %L134
; │└└└└
   ret {}* inttoptr (i64 123747077980168 to {}*)
; └
}</code></pre>
</div>
</div>
<div id="474da6ac" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a></a><span class="pp">@benchmark</span> <span class="fu">resids_turbo!</span>(<span class="op">$</span>e,<span class="op">$</span>y,<span class="op">$</span>θ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 245 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">309.061 ns</span> … <span class="ansi-magenta-fg">484.902 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">310.143 ns               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">312.312 ns</span> ± <span class="ansi-green-fg"> 10.349 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  █<span class="ansi-blue-fg">█</span>  <span class="ansi-green-fg"> </span>                ▁▂▂          ▁▁                          ▂
  █<span class="ansi-blue-fg">█</span>▆▁<span class="ansi-green-fg">▁</span>▁▁▁▁▁▁▁▁▁▁▁▄▄▆▇████▆▅▅▁▃▅▁▃▁███▁▁▁▃▄▃▄▄▄▁▆▇▅▁▄▄▃▁▁▅▃▃▄▄▅ █
  309 ns<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>        363 ns <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-manual-simd" class="slide level2">
<h2>Example: Manual SIMD</h2>
<div id="1247254a" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a></a><span class="fu">oneto</span>(<span class="op">::</span><span class="dt">Val{1}</span>) <span class="op">=</span> (<span class="fl">1</span>,)</span>
<span id="cb44-2"><a></a><span class="fu">oneto</span>(<span class="op">::</span><span class="dt">Val{N}</span>) <span class="kw">where</span> N <span class="op">=</span> (<span class="fu">oneto</span>(<span class="fu">Val</span>(N<span class="op">-</span><span class="fl">1</span>))<span class="op">...</span>, N)</span>
<span id="cb44-3"><a></a></span>
<span id="cb44-4"><a></a><span class="kw">function</span> <span class="fu">resids_simd!</span>(<span class="cn">e</span>,yin, θ, width<span class="op">::</span><span class="dt">Val{N}</span>=<span class="fu">Val</span>(<span class="fl">8</span>)) <span class="kw">where</span> N</span>
<span id="cb44-5"><a></a>  lane <span class="op">=</span> <span class="fu">VecRange</span><span class="dt">{N}</span>(<span class="fl">0</span>)</span>
<span id="cb44-6"><a></a>  tv<span class="op">=</span><span class="fu">Vec</span><span class="dt">{N,Float64}</span>(<span class="fu">oneto</span>(<span class="fu">Val</span>(N)))</span>
<span id="cb44-7"><a></a>  θ<span class="fl">1</span><span class="op">=</span><span class="fu">-Vec</span><span class="dt">{N,Float64}</span>(θ[<span class="fl">1</span>])</span>
<span id="cb44-8"><a></a>  θ<span class="fl">2</span><span class="op">=</span><span class="fu">-Vec</span><span class="dt">{N,Float64}</span>(θ[<span class="fl">2</span>])</span>
<span id="cb44-9"><a></a>  θ<span class="fl">3</span><span class="op">=</span><span class="fu">-Vec</span><span class="dt">{N,Float64}</span>(θ[<span class="fl">3</span>])</span>
<span id="cb44-10"><a></a>  remainder <span class="op">=</span> <span class="fu">length</span>(<span class="cn">e</span>) <span class="op">%</span> N</span>
<span id="cb44-11"><a></a>  <span class="pp">@inbounds</span> <span class="cf">for</span> t <span class="op">∈</span> <span class="fl">1</span><span class="op">:</span>N<span class="op">:</span>(<span class="fu">length</span>(<span class="cn">e</span>)<span class="op">-</span>remainder) <span class="co">#eachindex(e)</span></span>
<span id="cb44-12"><a></a>    <span class="pp">@fastmath</span> <span class="cn">e</span>[t<span class="op">+</span>lane] <span class="op">=</span> <span class="fu">muladd</span>(θ<span class="fl">2</span>,tv,yin[t<span class="op">+</span><span class="fl">1</span><span class="op">+</span>lane])<span class="fu">+muladd</span>(θ<span class="fl">3</span>,yin[t<span class="op">+</span>lane],θ<span class="fl">1</span>)</span>
<span id="cb44-13"><a></a>    <span class="pp">@fastmath</span> tv<span class="op">+=</span>N</span>
<span id="cb44-14"><a></a>  <span class="cf">end</span></span>
<span id="cb44-15"><a></a>  <span class="pp">@inbounds</span> <span class="cf">for</span> t <span class="op">∈</span> (<span class="fu">length</span>(<span class="cn">e</span>)<span class="op">-</span>remainder<span class="op">+</span><span class="fl">1</span>)<span class="op">:</span><span class="fu">length</span>(<span class="cn">e</span>)</span>
<span id="cb44-16"><a></a>    <span class="pp">@fastmath</span> <span class="cn">e</span>[t] <span class="op">=</span> <span class="fu">muladd</span>(<span class="op">-</span>θ[<span class="fl">2</span>],t<span class="op">+</span><span class="fl">1</span>,yin[t<span class="op">+</span><span class="fl">1</span>])<span class="fu">-muladd</span>(θ[<span class="fl">3</span>],yin[t],θ[<span class="fl">1</span>])</span>
<span id="cb44-17"><a></a>  <span class="cf">end</span></span>
<span id="cb44-18"><a></a>  <span class="cn">nothing</span></span>
<span id="cb44-19"><a></a><span class="kw">end</span></span>
<span id="cb44-20"><a></a></span>
<span id="cb44-21"><a></a><span class="pp">@benchmark</span> <span class="fu">resids_simd!</span>(<span class="op">$</span>e,<span class="op">$</span>y,<span class="op">$</span>θ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 372 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">251.602 ns</span> … <span class="ansi-magenta-fg">473.452 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">255.250 ns               </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">260.324 ns</span> ± <span class="ansi-green-fg"> 13.563 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  ▆ ▁<span class="ansi-blue-fg">█</span>▄▇  <span class="ansi-green-fg"> </span>    ▁▃▁ ▅▂▄     ▂ ▁                                  ▂
  ███<span class="ansi-blue-fg">█</span>██▁▁<span class="ansi-green-fg">▃</span>▃▄▇████████▅▁█▅▆█▇█▅▇▆▅▆▆█▇▇▆▆▇▆▆▆█▆▆▄▆▆▆▆▃▆▅▅▆▅▆▆▆▅ █
  252 ns<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>        319 ns <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</section>
<section id="example-necessary-manual-simd" class="slide level2">
<h2>Example: Necessary Manual SIMD</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div id="8a843c82" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb45-1"><a></a><span class="kw">function</span> <span class="fu">xx_xy!</span>(xx,xy,yin)</span>
<span id="cb45-2"><a></a>  T <span class="op">=</span> <span class="fu">length</span>(yin)</span>
<span id="cb45-3"><a></a>  xx <span class="op">.=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(xx))</span>
<span id="cb45-4"><a></a>  xy <span class="op">.=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(xy))</span>
<span id="cb45-5"><a></a>  <span class="pp">@inbounds</span> <span class="pp">@fastmath</span> <span class="pp">@simd</span> <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>T <span class="co"># @turbo errors</span></span>
<span id="cb45-6"><a></a>    xx[<span class="fl">1</span>,<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb45-7"><a></a>    xx[<span class="fl">2</span>,<span class="fl">3</span>] <span class="op">+=</span> t<span class="op">*</span>yin[t<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb45-8"><a></a>    xx[<span class="fl">3</span>,<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]<span class="op">^</span><span class="fl">2</span></span>
<span id="cb45-9"><a></a>    xy[<span class="fl">1</span>] <span class="op">+=</span> yin[t]</span>
<span id="cb45-10"><a></a>    xy[<span class="fl">2</span>] <span class="op">+=</span> t<span class="op">*</span>yin[t]</span>
<span id="cb45-11"><a></a>    xy[<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]<span class="op">*</span>yin[t]</span>
<span id="cb45-12"><a></a>  <span class="cf">end</span></span>
<span id="cb45-13"><a></a>  xx[<span class="fl">1</span>,<span class="fl">1</span>] <span class="op">=</span> T<span class="op">-</span><span class="fl">1</span> <span class="co"># = 1'*1</span></span>
<span id="cb45-14"><a></a>  xx[<span class="fl">1</span>,<span class="fl">2</span>] <span class="op">=</span> xx[<span class="fl">2</span>,<span class="fl">1</span>] <span class="op">=</span> (T<span class="op">+</span><span class="fl">1</span>)<span class="op">*</span>T<span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># sum(p+1:T)</span></span>
<span id="cb45-15"><a></a>  xx[<span class="fl">2</span>,<span class="fl">2</span>] <span class="op">=</span> (<span class="fl">2</span><span class="fu">*</span>(T)<span class="op">+</span><span class="fl">1</span>)<span class="fu">*</span>(T)<span class="fu">*</span>(T<span class="op">+</span><span class="fl">1</span>)<span class="op">/</span><span class="fl">6</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># sum((p+1:T).^2)</span></span>
<span id="cb45-16"><a></a>  xx[<span class="fl">3</span>,<span class="fl">1</span>] <span class="op">=</span> xx[<span class="fl">1</span>,<span class="fl">3</span>]</span>
<span id="cb45-17"><a></a>  xx[<span class="fl">3</span>,<span class="fl">2</span>] <span class="op">=</span> xx[<span class="fl">2</span>,<span class="fl">3</span>]</span>
<span id="cb45-18"><a></a>  <span class="cn">nothing</span></span>
<span id="cb45-19"><a></a><span class="kw">end</span></span>
<span id="cb45-20"><a></a></span>
<span id="cb45-21"><a></a>xx <span class="op">=</span> <span class="pp">@MMatrix</span> <span class="fu">zeros</span>(<span class="fl">3</span>,<span class="fl">3</span>)</span>
<span id="cb45-22"><a></a>xy <span class="op">=</span> <span class="pp">@MVector</span> <span class="fu">zeros</span>(<span class="fl">3</span>)</span>
<span id="cb45-23"><a></a><span class="pp">@benchmark</span> <span class="fu">xx_xy!</span>(<span class="op">$</span>xx,<span class="op">$</span>xy,<span class="op">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 9 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">2.852 μs</span> … <span class="ansi-magenta-fg"> 5.149 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">2.854 μs              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">2.864 μs</span> ± <span class="ansi-green-fg">97.949 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  █<span class="ansi-blue-fg">▇</span>  <span class="ansi-green-fg"> </span>                                                    ▁ ▁
  █<span class="ansi-blue-fg">█</span>█▄<span class="ansi-green-fg">▇</span>█▄▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▃▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▇█ █
  2.85 μs<span class="ansi-bright-black-fg">      </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>     3.04 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div id="de3bd025" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a></a><span class="kw">function</span> <span class="fu">xx_xy_simd!</span>(xx,xy,yin, v<span class="op">::</span><span class="dt">Val{N}</span>=<span class="fu">Val</span>(<span class="fl">32</span>)) <span class="kw">where</span> {N}</span>
<span id="cb46-2"><a></a>  T <span class="op">=</span> <span class="fu">length</span>(yin)</span>
<span id="cb46-3"><a></a>  remainder<span class="op">=</span>(T<span class="op">-</span><span class="fl">1</span>) <span class="op">%</span> N</span>
<span id="cb46-4"><a></a>  xx <span class="op">.=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(xx))</span>
<span id="cb46-5"><a></a>  xy <span class="op">.=</span> <span class="fu">zero</span>(<span class="fu">eltype</span>(xy))</span>
<span id="cb46-6"><a></a>  tv <span class="op">=</span> <span class="fu">Vec</span><span class="dt">{N,eltype(yin)}</span>(<span class="fu">oneto</span>(<span class="fu">Val</span>(N)))<span class="op">+</span><span class="fl">1</span></span>
<span id="cb46-7"><a></a>  lane <span class="op">=</span> <span class="fu">VecRange</span><span class="dt">{N}</span>(<span class="fl">0</span>)</span>
<span id="cb46-8"><a></a>  <span class="pp">@inbounds</span> <span class="cf">for</span> t <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>N<span class="op">:</span>(T<span class="op">-</span>remainder)</span>
<span id="cb46-9"><a></a>    xx[<span class="fl">1</span>,<span class="fl">3</span>] <span class="op">+=</span> <span class="fu">sum</span>(yin[t<span class="op">-</span><span class="fl">1</span><span class="op">+</span>lane])</span>
<span id="cb46-10"><a></a>    xx[<span class="fl">2</span>,<span class="fl">3</span>] <span class="op">+=</span> <span class="fu">sum</span>(yin[t<span class="op">-</span><span class="fl">1</span><span class="op">+</span>lane]<span class="op">*</span>tv)</span>
<span id="cb46-11"><a></a>    xx[<span class="fl">3</span>,<span class="fl">3</span>] <span class="op">+=</span> <span class="fu">sum</span>(yin[t<span class="op">-</span><span class="fl">1</span><span class="op">+</span>lane]<span class="op">^</span><span class="fl">2</span>)</span>
<span id="cb46-12"><a></a>    xy[<span class="fl">1</span>] <span class="op">+=</span> <span class="fu">sum</span>(yin[t<span class="op">+</span>lane])</span>
<span id="cb46-13"><a></a>    xy[<span class="fl">2</span>] <span class="op">+=</span> <span class="fu">sum</span>(tv<span class="op">*</span>yin[t<span class="op">+</span>lane])</span>
<span id="cb46-14"><a></a>    xy[<span class="fl">3</span>] <span class="op">+=</span> <span class="fu">sum</span>(yin[t<span class="op">-</span><span class="fl">1</span><span class="op">+</span>lane]<span class="op">*</span>yin[t<span class="op">+</span>lane])</span>
<span id="cb46-15"><a></a>    tv <span class="op">+=</span> N</span>
<span id="cb46-16"><a></a>  <span class="cf">end</span></span>
<span id="cb46-17"><a></a>  <span class="pp">@inbounds</span> <span class="cf">for</span> t <span class="kw">in</span> (T<span class="op">-</span>remainder<span class="op">+</span><span class="fl">1</span>)<span class="op">:</span>T</span>
<span id="cb46-18"><a></a>    xx[<span class="fl">1</span>,<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]</span>
<span id="cb46-19"><a></a>    xx[<span class="fl">2</span>,<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]<span class="op">*</span>t</span>
<span id="cb46-20"><a></a>    xx[<span class="fl">3</span>,<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]<span class="op">^</span><span class="fl">2</span></span>
<span id="cb46-21"><a></a>    xy[<span class="fl">1</span>] <span class="op">+=</span> yin[t]</span>
<span id="cb46-22"><a></a>    xy[<span class="fl">2</span>] <span class="op">+=</span> t<span class="op">*</span>yin[t]</span>
<span id="cb46-23"><a></a>    xy[<span class="fl">3</span>] <span class="op">+=</span> yin[t<span class="op">-</span><span class="fl">1</span>]<span class="op">*</span>yin[t]</span>
<span id="cb46-24"><a></a>  <span class="cf">end</span></span>
<span id="cb46-25"><a></a>  xx[<span class="fl">1</span>,<span class="fl">1</span>] <span class="op">=</span> T<span class="op">-</span><span class="fl">1</span> <span class="co"># = 1'*1</span></span>
<span id="cb46-26"><a></a>  xx[<span class="fl">1</span>,<span class="fl">2</span>] <span class="op">=</span> xx[<span class="fl">2</span>,<span class="fl">1</span>] <span class="op">=</span> (T<span class="op">+</span><span class="fl">1</span>)<span class="op">*</span>T<span class="op">/</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># sum(2:T)</span></span>
<span id="cb46-27"><a></a>  xx[<span class="fl">2</span>,<span class="fl">2</span>] <span class="op">=</span> (<span class="fl">2</span><span class="fu">*</span>(T)<span class="op">+</span><span class="fl">1</span>)<span class="fu">*</span>(T)<span class="fu">*</span>(T<span class="op">+</span><span class="fl">1</span>)<span class="op">/</span><span class="fl">6</span> <span class="op">-</span> <span class="fl">1</span> <span class="co"># sum((2:T).^2)</span></span>
<span id="cb46-28"><a></a>  xx[<span class="fl">3</span>,<span class="fl">1</span>] <span class="op">=</span> xx[<span class="fl">1</span>,<span class="fl">3</span>]</span>
<span id="cb46-29"><a></a>  xx[<span class="fl">3</span>,<span class="fl">2</span>] <span class="op">=</span> xx[<span class="fl">2</span>,<span class="fl">3</span>]</span>
<span id="cb46-30"><a></a>  <span class="cn">nothing</span></span>
<span id="cb46-31"><a></a><span class="kw">end</span></span>
<span id="cb46-32"><a></a></span>
<span id="cb46-33"><a></a><span class="pp">@benchmark</span> <span class="fu">xx_xy_simd!</span>(<span class="op">$</span>xx,<span class="op">$</span>xy,<span class="op">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div class="ansi-escaped-output">
<pre>BenchmarkTools.Trial: 10000 samples with 62 evaluations.
 Range <span class="ansi-bright-black-fg">(</span><span class="ansi-cyan-fg ansi-bold">min</span> … <span class="ansi-magenta-fg">max</span><span class="ansi-bright-black-fg">):  </span><span class="ansi-cyan-fg ansi-bold">860.161 ns</span> … <span class="ansi-magenta-fg"> 1.981 μs</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>min … max<span class="ansi-bright-black-fg">): </span>0.00% … 0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-blue-fg ansi-bold">median</span><span class="ansi-bright-black-fg">):     </span><span class="ansi-blue-fg ansi-bold">870.444 ns              </span><span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>median<span class="ansi-bright-black-fg">):    </span>0.00%
 Time  <span class="ansi-bright-black-fg">(</span><span class="ansi-green-fg ansi-bold">mean</span> ± <span class="ansi-green-fg">σ</span><span class="ansi-bright-black-fg">):   </span><span class="ansi-green-fg ansi-bold">907.149 ns</span> ± <span class="ansi-green-fg">67.355 ns</span>  <span class="ansi-bright-black-fg">┊</span> GC <span class="ansi-bright-black-fg">(</span>mean ± σ<span class="ansi-bright-black-fg">):  </span>0.00% ± 0.00%
  █▇<span class="ansi-blue-fg">▃</span>     <span class="ansi-green-fg"> </span>▄▇▅   ▅▅▂   ▃▁    ▁                                 ▂
  ██<span class="ansi-blue-fg">█</span>▁▁▁▁▁<span class="ansi-green-fg">▁</span>████▇▆███▄▃███▆▄▅▇██▆▄▅▅██▇▆▅▇▆▆▆▆▆▅▇▆▅▆▇▆▆▆▅▆▇▆▆▆▆ █
  860 ns<span class="ansi-bright-black-fg">        </span><span class="ansi-bright-black-fg">Histogram: </span><span class="ansi-bright-black-fg ansi-bold">log(</span><span class="ansi-bright-black-fg">frequency</span><span class="ansi-bright-black-fg ansi-bold">)</span><span class="ansi-bright-black-fg"> by time</span>      1.19 μs <span class="ansi-bold">&lt;</span>
 Memory estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0 bytes</span>, allocs estimate<span class="ansi-bright-black-fg">: </span><span class="ansi-yellow-fg">0</span>.</pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-nissen2022" class="csl-entry" role="listitem">
Nissen, Jakob Nybo. 2022. <span>“How to Optimise Julia Code: A Practical Guide.”</span> <a href="https://viralinstruction.com/posts/optimise/#how_to_optimise_julia_code_a_practical_guide">https://viralinstruction.com/posts/optimise/#how_to_optimise_julia_code_a_practical_guide</a>.
</div>
<div id="ref-rackauckas2019a" class="csl-entry" role="listitem">
Rackauckas, Chris. 2019. <span>“Optimizing Serial Code.”</span> <a href="https://book.sciml.ai/notes/02-Optimizing_Serial_Code/">https://book.sciml.ai/notes/02-Optimizing_Serial_Code/</a>.
</div>
<div id="ref-schrimpfARGridBootstrap" class="csl-entry" role="listitem">
Schrimpf, Paul. 2019 (revised 2024). <span>“<span class="nocase">Coding for Performance</span>.”</span> <a href="https://schrimpf.github.io/ARGridBootstrap.jl/argridboot.html">https://schrimpf.github.io/ARGridBootstrap.jl/argridboot.html</a>.
</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true,"theme":"whiteboard","boardmarkerWidth":2,"chalkWidth":2,"chalkEffect":0},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1575,

        height: 1050,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.1,

        maxScale: 3,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/schrimpf\.github\.io\/ARGridBootstrap\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>